<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/suite_dns/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>suite_dns - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "suite_dns";
        var mkdocs_page_input_path = "roles/suite_dns.md";
        var mkdocs_page_url = "/ansible-devops/roles/suite_dns/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/cp4d/">Install Cloud Pak For Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-iot/">Add IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-manage/">Add Manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-monitor/">Add Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-optimizer/">Add Optimizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-predict/">Add Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-visualinspection/">Add Visual Inspection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-upgrade/">Upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/uninstall-core/">Uninstall Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/backup-restore/">Backup & Restore</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_cluster_monitoring/">ocp_cluster_monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_config/">ocp_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_efs/">ocp_efs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_node_config/">ocp_node_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_bucket_access_point/">aws_bucket_access_point</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_documentdb_user/">aws_documentdb_user</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_policy/">aws_policy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_route53/">aws_route53</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_user_creation/">aws_user_creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_vpc/">aws_vpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cis/">cis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../common_services/">common-services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configure_manage_eventstreams/">configure_manage_eventstreams</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos_bucket/">cos_bucket</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_admin_pwd_update/">cp4d_admin_pwd_update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d/">cp4d</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_service/">cp4d_service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dro/">dro</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../grafana/">grafana</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ibm_catalogs/">ibm_catalogs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mongodb/">mongodb</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../turbonomic/">turbonomic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Image Mirroring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_case_prepare/">mirror_case_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_extras_prepare/">mirror_extras_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_images/">mirror_images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_ocp/">mirror_ocp</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_contentsourcepolicy/">ocp_contentsourcepolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_simulate_disconnected_network/">ocp_simulate_disconnected_network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../registry/">registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_uninstall/">suite_app_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_upgrade/">suite_app_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_rollback/">suite_app_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_backup_restore/">suite_app_backup_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_certs/">suite_certs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">suite_dns</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dns-management">DNS management</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#top-level-dns-entries">Top Level DNS entries</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#subdomain-dns-entries">Subdomain DNS entries</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lets-encrypt-integration">Let's Encrypt Integration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-general">Role Variables - General</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dns_provider">dns_provider</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_instance_id">mas_instance_id:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_workspace_id">mas_workspace_id:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_domain">mas_domain</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ocp_ingress">ocp_ingress</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cert_manager_namespace">cert_manager_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#custom_labels">custom_labels</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-cloudflare-dns-integration">Role Variables - Cloudflare DNS Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cloudflare_email">cloudflare_email</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cloudflare_apitoken">cloudflare_apitoken</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cloudflare_zone">cloudflare_zone</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cloudflare_subdomain">cloudflare_subdomain</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-ibm-cloud-internet-services-dns-integration">Role Variables - IBM Cloud Internet Services DNS Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cis_email">cis_email</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_apikey">cis_apikey</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_crn">cis_crn</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_subdomain">cis_subdomain</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_enhanced_security">cis_enhanced_security</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-enhanced-ibm-cis-dns-integration-secruity">Role Variables - Enhanced IBM CIS DNS Integration Secruity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cis_waf">cis_waf</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_proxy">cis_proxy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cis_service_name">cis_service_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#update_dns">update_dns</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#delete_wildcards">delete_wildcards</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#override_edge_certs">override_edge_certs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#output_dir">output_dir</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-aws-route-53">Role Variables - AWS Route 53</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#route53_hosted_zone_name">route53_hosted_zone_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#route53_hosted_zone_region">route53_hosted_zone_region</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#route53_subdomain">route53_subdomain</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#route53_email">route53_email</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-cloudpak-for-data">Role Variables - CloudPak for Data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cpd_instance_namespace">cpd_instance_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cpd_prod_issuer_name">cpd_prod_issuer_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cpd_custom_domain">cpd_custom_domain</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook-cis-or-cloudflare">Example Playbook - CIS or Cloudflare</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook-aws-route-53">Example Playbook - AWS Route 53</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_attachments_config/">suite_manage_attachments_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_birt_report_config/">suite_manage_birt_report_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_bim_config/">suite_manage_bim_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_customer_files_config/">suite_manage_customer_files_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_import_certs_config/">suite_manage_import_certs_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_load_dbc_scripts/">suite_manage_load_dbc_scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_logging_config/">suite_manage_logging_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_pvc_config/">suite_manage_pvc_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_uninstall/">suite_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_rollback/">suite_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_backup_restore/">suite_backup_restore</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../entitlement_key_rotation/">entitlement_key_rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_watsonstudio/">gencfg_watsonstudio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_mongo/">gencfg_mongo</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Roles: Suite Mgmt</li>
      <li class="breadcrumb-item active">suite_dns</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/suite_dns.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="suite_dns">suite_dns<a class="headerlink" href="#suite_dns" title="Permanent link"></a></h1>
<p>This role will manage MAS and DNS provider integration.  IBM Cloud Internet Services is the only supported DNS provider currently. It will also create a secure route (https://cp4d.<mas_domain>) to the CP4D web client using the custom domain used in this role.</p>
<p><strong>Note</strong>: this role will take no action when <code>mas_manual_cert_mgmt</code>is set to <code>True</code></p>
<h2 id="dns-management">DNS management<a class="headerlink" href="#dns-management" title="Permanent link"></a></h2>
<p>There are two different ways this role controls DNS entries in the provider:</p>
<h3 id="top-level-dns-entries">Top Level DNS entries<a class="headerlink" href="#top-level-dns-entries" title="Permanent link"></a></h3>
<p>This mode will create the entries directly under your DNS zone. Use this when the DNS zone matches the MAS domain exactly.  If your MAS installation will be using the domain <strong>mymas.mycompany.com</strong> and you have a DNS zone for <strong>mymas.mycompany.com</strong> then you will be creating top-level DNS entries for MAS, e.g. <strong>admin</strong>, <strong>home</strong>, &amp; <strong>api</strong>.</p>
<h3 id="subdomain-dns-entries">Subdomain DNS entries<a class="headerlink" href="#subdomain-dns-entries" title="Permanent link"></a></h3>
<p>This mode will create DNS entries in the zone under a subdomain. Use this when your DNS zone will be used for more than just one MAS instance. If your MAS installation will be using the domain <strong>mymas.mycompany.com</strong> and you have a DNS zone for <strong>mycompany.com</strong> then you will be creating subdomain DNS entries for MAS, e.g. <strong>admin.mymas</strong>, <strong>home.mymas</strong>, &amp; <strong>api.mymas</strong>.</p>
<p>CIS and Cloudflare integrations support both mode of DNS management. A single optional variable is required to enable subdomain DNS management, in the examples above you would set these to <strong>mymas</strong>:</p>
<ul>
<li><a href="#cis_subdomain">cis_subdomain</a></li>
<li><a href="#cloudflare_subdomain">cloudflare_subdomain</a></li>
</ul>
<h2 id="lets-encrypt-integration">Let's Encrypt Integration<a class="headerlink" href="#lets-encrypt-integration" title="Permanent link"></a></h2>
<p>Both the CIS and Cloudflare options also enable integration with <a href="https://letsencrypt.org/">Let's Encrypt</a> for automatic certificate management via IBM Certificate Manager.  Each will create a new <a href="https://cert-manager.io/docs/reference/api-docs/#cert-manager.io/v1.ClusterIssuer">ClusterIssuer</a> which can be used when installing Maximo Application Suite:</p>
<ul>
<li>Cloudflare Let's Encrypt ClusterIssuer: <code>{{ mas_instance_id }}-cloudflare-le-prod</code></li>
<li>IBM Cloud Internet Services Let's Encrypt ClusterIssuer: <code>{{ mas_instance_id }}-cis-le-prod</code></li>
</ul>
<p>If you want to use Let's Encrypt certificates in your MAS installation you will need to configure the <code>mas_cluster_issuer</code> variable in the <a href="../suite_install/">suite_install</a> role, setting it to the name of the ClusterIssuer as documented above.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are issues with how cert-manager works with LetsEncrypt staging servers. It creates a secret for the certificate that doesn't contain the LetsEncrypt CA, but the staging service does not use a well known cert so we end up with MAS unable to trust the certificates generated by LetsEncrypt staging.</p>
<p>At present there is no workaround for this, so do not use the LetsEncrypt staging certificate issuer.</p>
</div>
<h2 id="role-variables-general">Role Variables - General<a class="headerlink" href="#role-variables-general" title="Permanent link"></a></h2>
<h3 id="dns_provider">dns_provider<a class="headerlink" href="#dns_provider" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong></li>
<li>Environment Variable: <code>DNS_PROVIDER</code></li>
<li>Default: None</li>
</ul>
<h3 id="mas_instance_id">mas_instance_id:<a class="headerlink" href="#mas_instance_id" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong></li>
<li>Environment Variable: <code>MAS_INSTANCE_ID</code></li>
<li>Default: None</li>
</ul>
<h3 id="mas_workspace_id">mas_workspace_id:<a class="headerlink" href="#mas_workspace_id" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong></li>
<li>Environment Variable: <code>MAS_WORKSPACE_ID</code></li>
<li>Default: None</li>
</ul>
<h3 id="mas_domain">mas_domain<a class="headerlink" href="#mas_domain" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong></li>
<li>Environment Variable: <code>MAS_DOMAIN</code></li>
<li>Default: None</li>
</ul>
<h3 id="ocp_ingress">ocp_ingress<a class="headerlink" href="#ocp_ingress" title="Permanent link"></a></h3>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>OCP_INGRESS</code></li>
<li>Default: None</li>
</ul>
<h3 id="cert_manager_namespace">cert_manager_namespace<a class="headerlink" href="#cert_manager_namespace" title="Permanent link"></a></h3>
<p>Namespace where Certificate Manager is installed.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CERT_MANAGER_NAMESPACE</code></li>
<li>Default: None</li>
</ul>
<h3 id="custom_labels">custom_labels<a class="headerlink" href="#custom_labels" title="Permanent link"></a></h3>
<p>List of comma separated key=value pairs for setting custom labels on instance specific resources.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CUSTOM_LABELS</code></li>
<li>Default: None</li>
</ul>
<h2 id="role-variables-cloudflare-dns-integration">Role Variables - Cloudflare DNS Integration<a class="headerlink" href="#role-variables-cloudflare-dns-integration" title="Permanent link"></a></h2>
<h3 id="cloudflare_email">cloudflare_email<a class="headerlink" href="#cloudflare_email" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cloudflare</code></li>
<li>Environment Variable: <code>CLOUDFLARE_EMAIL</code></li>
<li>Default: None</li>
</ul>
<h3 id="cloudflare_apitoken">cloudflare_apitoken<a class="headerlink" href="#cloudflare_apitoken" title="Permanent link"></a></h3>
<p>To generate an API token follow the <a href="https://developers.cloudflare.com/api/tokens/create/">Cloudflare documentation</a>.</p>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cloudflare</code></li>
<li>Environment Variable: <code>CLOUDFLARE_APITOKEN</code></li>
<li>Default: None</li>
</ul>
<h3 id="cloudflare_zone">cloudflare_zone<a class="headerlink" href="#cloudflare_zone" title="Permanent link"></a></h3>
<p>This is your domain name that is managed by Cloudflare (e.g. <code>mydomain.com</code>).</p>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cloudflare</code></li>
<li>Environment Variable: <code>CLOUDFLARE_ZONE</code></li>
<li>Default: None</li>
</ul>
<h3 id="cloudflare_subdomain">cloudflare_subdomain<a class="headerlink" href="#cloudflare_subdomain" title="Permanent link"></a></h3>
<p>Set this to the name of the subdomain under your Cloudflare domain where you would like to manage the MAS DNS entires if you don't want MAS to use the top-level domain itself.  In other words <code>cloudflare_subdomain.cloudflare_zone</code> should equal <code>mas_domain</code>.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CLOUDFLARE_SUBDOMAIN</code></li>
<li>Default: None</li>
</ul>
<h2 id="role-variables-ibm-cloud-internet-services-dns-integration">Role Variables - IBM Cloud Internet Services DNS Integration<a class="headerlink" href="#role-variables-ibm-cloud-internet-services-dns-integration" title="Permanent link"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>When using CIS integration, some resources will be installed in the cluster such as RBACs, API Services and CIS Webhook deployments.
  In OCP 4.12+, to avoid CIS webhook deployment failure at start up, this role will grant <code>anyuid</code> permission to <code>cert-manager-webhook-ibm-cis</code> service account so it can fully access the cert-manager-webhook-ibm-cis deployment pod as a workaround:
  <code>oc adm policy add-scc-to-user anyuid -z cert-manager-webhook-ibm-cis -n ibm-common-services</code></p>
<h3 id="cis_email">cis_email<a class="headerlink" href="#cis_email" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cis</code>. This is the e-mail that will be used in the Cluster Issuer resource, created by this role, to connect with the certificate manager (i.e. Let's Encrypt).</li>
<li>Environment Variable: <code>CIS_EMAIL</code></li>
<li>Default: None</li>
</ul>
<h3 id="cis_apikey">cis_apikey<a class="headerlink" href="#cis_apikey" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cis</code></li>
<li>Environment Variable: <code>CIS_APIKEY</code></li>
<li>Default: None</li>
</ul>
<h3 id="cis_crn">cis_crn<a class="headerlink" href="#cis_crn" title="Permanent link"></a></h3>
<ul>
<li><strong>Required</strong> if <code>dns_provider</code> is set to <code>cis</code></li>
<li>Environment Variable: <code>CIS_CRN</code></li>
<li>Default: None</li>
</ul>
<h3 id="cis_subdomain">cis_subdomain<a class="headerlink" href="#cis_subdomain" title="Permanent link"></a></h3>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CIS_SUBDOMAIN</code></li>
<li>Default: None</li>
</ul>
<h3 id="cis_enhanced_security">cis_enhanced_security<a class="headerlink" href="#cis_enhanced_security" title="Permanent link"></a></h3>
<p>Set this to true to enable the enhanced IBM CIS DNS integration security - which includes:
- Enabling WAF firewall disabling rules that affect MAS application functionalities
- Enabling Proxy for DNS entries
- Using an expanded list of DNS entries
- Ensuring there are no wildcard DNS entry in CIS
- Creating Edge Certificates in CIS instance
See https://cloud.ibm.com/docs/cis?topic=cis-manage-your-ibm-cis-for-optimal-security for more details.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CIS_ENHANCED_SECURITY</code></li>
<li>Default: false</li>
</ul>
<h2 id="role-variables-enhanced-ibm-cis-dns-integration-secruity">Role Variables - Enhanced IBM CIS DNS Integration Secruity<a class="headerlink" href="#role-variables-enhanced-ibm-cis-dns-integration-secruity" title="Permanent link"></a></h2>
<p>See the "cis_enhanced_security" variable above for details.</p>
<h3 id="cis_waf">cis_waf<a class="headerlink" href="#cis_waf" title="Permanent link"></a></h3>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CIS_WAF</code></li>
<li>Default: true</li>
</ul>
<h3 id="cis_proxy">cis_proxy<a class="headerlink" href="#cis_proxy" title="Permanent link"></a></h3>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CIS_PROXY</code></li>
<li>Default: false</li>
</ul>
<h3 id="cis_service_name">cis_service_name<a class="headerlink" href="#cis_service_name" title="Permanent link"></a></h3>
<p>Set this to override the default CIS service name that would otherwise be created as {ClusterName}-cis-{mas_instance_id} (where Cluster Name is derived automatically from the cluster)</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CIS_SERVICE_NAME</code></li>
</ul>
<h3 id="update_dns">update_dns<a class="headerlink" href="#update_dns" title="Permanent link"></a></h3>
<p>Set this to false if you want to not update DNS entries if they already exist</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>UPDATE_DNS_ENTRIES</code></li>
<li>Default: true</li>
</ul>
<h3 id="delete_wildcards">delete_wildcards<a class="headerlink" href="#delete_wildcards" title="Permanent link"></a></h3>
<p>Set this to true to force deletion of wildcard dns entries in cis</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>DELETE_WILDCARDS</code></li>
<li>Default: false</li>
</ul>
<h3 id="override_edge_certs">override_edge_certs<a class="headerlink" href="#override_edge_certs" title="Permanent link"></a></h3>
<p>Set this to false to not override and delete any existing edge certificates in cis instance when creating new edge certificates</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>OVERRIDE_EDGE_CERTS</code></li>
<li>Default: true</li>
</ul>
<h3 id="output_dir">output_dir<a class="headerlink" href="#output_dir" title="Permanent link"></a></h3>
<p>Location to output the edge-routes-{mas_instance_id}.txt</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>OUTPUT_DIR</code></li>
<li>Default: <code>.</code> (which will set the directory file in ibm/mas_devops)</li>
</ul>
<h2 id="role-variables-aws-route-53">Role Variables - AWS Route 53<a class="headerlink" href="#role-variables-aws-route-53" title="Permanent link"></a></h2>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h2>
<p>To run this role successfully you must have already installed the <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a>.
Also, you need to have AWS user credentials configured via <code>aws configure</code> command or simply export <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with your corresponding AWS username credentials prior running this role.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some cases, the Route 53 zone may not resolve the certificate challenges generated by IBM Certificate Manager, which could cause a problem while issuing the public certificates via Let's Encrypt. In this case, a manual workaround might be needed in cert-manager-controller pod to enable recursive nameservers.</p>
<p>For more details on how to apply this workaround, refer to <a href="https://community.ibm.com/community/user/asset-facilities/blogs/brian-zhu/2022/10/08/using-lets-encrypt-ssl-certificates-with-maximo-ap?CommunityKey=3d7261ae-48f7-481d-b675-a40eb407e0fd">this documentation</a>.</p>
<p>This workaround is not automated, as most of the times this is not needed, but when it is, it requires the <code>cert-manager-controller</code> pod to be stopped, thus we want to avoid making this behavior as standard approach.</p>
</div>
<h3 id="route53_hosted_zone_name">route53_hosted_zone_name<a class="headerlink" href="#route53_hosted_zone_name" title="Permanent link"></a></h3>
<p>AWS Route53 Hosted Zone name.</p>
<ul>
<li>Required.</li>
<li>Environment Variable: <code>ROUTE53_HOSTED_ZONE_NAME</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="route53_hosted_zone_region">route53_hosted_zone_region<a class="headerlink" href="#route53_hosted_zone_region" title="Permanent link"></a></h3>
<p>AWS Route53 Hosted Zone region.</p>
<ul>
<li>Required.</li>
<li>Environment Variable: <code>ROUTE53_HOSTED_ZONE_REGION</code></li>
<li>Default Value: Same value as defined in <code>AWS_REGION</code>, or if none defined, then <code>us-east-2</code> is the defaulted region.</li>
</ul>
<h3 id="route53_subdomain">route53_subdomain<a class="headerlink" href="#route53_subdomain" title="Permanent link"></a></h3>
<p>If a subdomain is defined, this will be used to create the corresponding CNAME entries in the targeted Route53 hosted zone instance.
Therefore, the Route53 subdomain + the Route53 hosted zone name defined, when combined, needs to match with the chosen MAS Domain, otherwise the DNS records won't be able to get resolved.</p>
<pre><code>Example:
MAS Top Level Domain: my-mas-instance.mycompany.com
AWS Route53 hosted zone name: mycompany.com
AWS Route53 subdomain: my-mas-instance
</code></pre>
<ul>
<li>Optional.</li>
<li>Environment Variable: <code>ROUTE53_SUBDOMAIN</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="route53_email">route53_email<a class="headerlink" href="#route53_email" title="Permanent link"></a></h3>
<p>AWS Route53 contact e-mail. Will be set in the cluster issuer created in order to receive alerts.</p>
<ul>
<li>Optional.</li>
<li>Environment Variable: <code>ROUTE53_EMAIL</code></li>
<li>Default Value: None.</li>
</ul>
<h2 id="role-variables-cloudpak-for-data">Role Variables - CloudPak for Data<a class="headerlink" href="#role-variables-cloudpak-for-data" title="Permanent link"></a></h2>
<h3 id="cpd_instance_namespace">cpd_instance_namespace<a class="headerlink" href="#cpd_instance_namespace" title="Permanent link"></a></h3>
<p>Namespace where the Cloud Pak for Data is installed and the <code>cpd</code> route exists.
If set, then this role will also attempt to configure public certificates to the CPD route using the DNS provider defined.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CPD_INSTANCE_NAMESPACE</code></li>
<li>Default Value: None.</li>
</ul>
<h3 id="cpd_prod_issuer_name">cpd_prod_issuer_name<a class="headerlink" href="#cpd_prod_issuer_name" title="Permanent link"></a></h3>
<p>Define the certificate issuer responsible for generating the public certificate for your CPD route.
If not set, then it will use same issuer set for MAS instance.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CPD_PROD_ISSUER_NAME</code></li>
<li>Default Value: Same certificate issuer used for MAS instance.</li>
</ul>
<h3 id="cpd_custom_domain">cpd_custom_domain<a class="headerlink" href="#cpd_custom_domain" title="Permanent link"></a></h3>
<p>Define the custom domain for your CPD route.
If not set, then it will use same domain set for MAS instance.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CPD_CUSTOM_DOMAIN</code></li>
<li>Default Value: <code>cp4d.{{ mas_domain }}</code>.</li>
</ul>
<h2 id="example-playbook-cis-or-cloudflare">Example Playbook - CIS or Cloudflare<a class="headerlink" href="#example-playbook-cis-or-cloudflare" title="Permanent link"></a></h2>
<pre><code class="language-yaml">---
- hosts: localhost
  any_errors_fatal: true
  vars:
    dns_provider: cis OR cloudflare
    mas_instance_id: inst1
    mas_domain: mydomain.com
    cis_crn: xxx
    cis_apikey: xxx
    cis_email: xxx
  roles:
    - ibm.mas_devops.suite_dns
</code></pre>
<h2 id="example-playbook-aws-route-53">Example Playbook - AWS Route 53<a class="headerlink" href="#example-playbook-aws-route-53" title="Permanent link"></a></h2>
<pre><code class="language-yaml">---
- hosts: localhost
  any_errors_fatal: true
  vars:
    dns_provider: route53
    mas_instance_id: inst1
    mas_domain: inst1.mydomain.com
    aws_access_key_id: xxx
    aws_secret_access_key: xxx
    route53_hosted_zone_name: mydomain.com
    route53_hosted_zone_region: us-east-2
    route53_subdomain: inst1
    route53_email: anyemail@test.com
  roles:
    - ibm.mas_devops.suite_dns
</code></pre>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../suite_db2_setup_for_manage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../suite_install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
