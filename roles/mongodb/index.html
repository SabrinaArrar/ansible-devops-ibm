<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/mongodb/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>mongodb - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mongodb";
        var mkdocs_page_input_path = "roles/mongodb.md";
        var mkdocs_page_url = "/ansible-devops/roles/mongodb/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/cp4d/">Install Cloud Pak For Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-iot/">Add IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-manage/">Add Manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-monitor/">Add Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-optimizer/">Add Optimizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-predict/">Add Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-visualinspection/">Add Visual Inspection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-upgrade/">Upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/uninstall-core/">Uninstall Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_cluster_monitoring/">ocp_cluster_monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_config/">ocp_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_efs/">ocp_efs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_node_config/">ocp_node_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_bucket_access_point/">aws_bucket_access_point</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_documentdb_user/">aws_documentdb_user</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_policy/">aws_policy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_route53/">aws_route53</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_user_creation/">aws_user_creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_vpc/">aws_vpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cis/">cis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../common_services/">common-services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configure_manage_eventstreams/">configure_manage_eventstreams</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos_bucket/">cos_bucket</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_admin_pwd_update/">cp4d_admin_pwd_update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d/">cp4d</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_service/">cp4d_service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_backup/">db2_backup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_restore/">db2_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dro/">dro</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../grafana/">grafana</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ibm_catalogs/">ibm_catalogs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">mongodb</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#common-role-variables-for-all-providers">Common Role Variables for all providers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mas_instance_id">mas_instance_id</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_config_dir">mas_config_dir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_provider">mongodb_provider</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_action">mongodb_action</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#community-mongodb-role-variables">Community MongoDB Role Variables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables">Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_namespace">mongodb_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_version">mongodb_version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_class">mongodb_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_capacity_data">mongodb_storage_capacity_data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_capacity_logs">mongodb_storage_capacity_logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_cpu_limits">mongodb_cpu_limits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_mem_limits">mongodb_mem_limits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_cpu_requests">mongodb_cpu_requests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_mem_requests">mongodb_mem_requests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_replicas">mongodb_replicas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#custom_labels">custom_labels</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_v5_upgrade">mongodb_v5_upgrade</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_v6_upgrade">mongodb_v6_upgrade</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb-replica-set-pods-will-not-start">MongoDB Replica Set Pods Will Not Start</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ca-certificate-renewal">CA Certificate Renewal</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ibm-cloud-mongodb-role-variables">IBM Cloud MongoDB Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_name">ibm_mongo_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_admin_password">ibm_mongo_admin_password</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_admin_credentials_secret_name">ibm_mongo_admin_credentials_secret_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_service_credentials_secret_name">ibm_mongo_service_credentials_secret_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_resourcegroup">ibm_mongo_resourcegroup</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_region">ibm_mongo_region</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibmcloud_apikey">ibmcloud_apikey</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_plan">ibm_mongo_plan</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_service">ibm_mongo_service</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_service_endpoints">ibm_mongo_service_endpoints</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_version">ibm_mongo_version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_memory">ibm_mongo_memory</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_disk">ibm_mongo_disk</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_cpu">ibm_mongo_cpu</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_name_1">ibm_mongo_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm_mongo_backup_id">ibm_mongo_backup_id</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#is_restore">is_restore</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restored_mongodb_service_name">restored_mongodb_service_name</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook_1">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#aws-documentdb-role-variables">AWS DocumentDB Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#aws_access_key_id">aws_access_key_id</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#aws_secret_access_key">aws_secret_access_key</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#aws_region">aws_region</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#vpc_id">vpc_id</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_cluster_name">docdb_cluster_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_subnet_group_name">docdb_subnet_group_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_security_group_name">docdb_security_group_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_admin_credentials_secret_name">docdb_admin_credentials_secret_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_engine_version">docdb_engine_version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_master_username">docdb_master_username</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_instance_class">docdb_instance_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_instance_number">docdb_instance_number</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_instance_identifier_prefix">docdb_instance_identifier_prefix</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_ingress_cidr">docdb_ingress_cidr</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_egress_cidr">docdb_egress_cidr</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_cidr_az1">docdb_cidr_az1:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_cidr_az2">docdb_cidr_az2:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_cidr_az3">docdb_cidr_az3:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook_2">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#aws-documentdb-secret-rotate-role-variables">AWS DocumentDB Secret Rotate role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_mongo_instance_name">docdb_mongo_instance_name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_host">docdb_host</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_port">docdb_port</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_instance_username">docdb_instance_username</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_instance_password_old">docdb_instance_password_old</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_master_password">docdb_master_password</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docdb_master_username_1">docdb_master_username</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook_3">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../turbonomic/">turbonomic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Image Mirroring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_case_prepare/">mirror_case_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_extras_prepare/">mirror_extras_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_images/">mirror_images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_ocp/">mirror_ocp</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_contentsourcepolicy/">ocp_contentsourcepolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_simulate_disconnected_network/">ocp_simulate_disconnected_network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../registry/">registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_uninstall/">suite_app_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_upgrade/">suite_app_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_rollback/">suite_app_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_certs/">suite_certs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_dns/">suite_dns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_attachments_config/">suite_manage_attachments_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_birt_report_config/">suite_manage_birt_report_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_bim_config/">suite_manage_bim_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_customer_files_config/">suite_manage_customer_files_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_import_certs_config/">suite_manage_import_certs_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_load_dbc_scripts/">suite_manage_load_dbc_scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_logging_config/">suite_manage_logging_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_pvc_config/">suite_manage_pvc_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_uninstall/">suite_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_rollback/">suite_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../entitlement_key_rotation/">entitlement_key_rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_watsonstudio/">gencfg_watsonstudio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_mongo/">gencfg_mongo</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Roles: Dependency Mgmt</li>
      <li class="breadcrumb-item active">mongodb</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/mongodb.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mongodb">mongodb<a class="headerlink" href="#mongodb" title="Permanent link"></a></h1>
<p>This role currently supports provisioning of mongodb in three different providers:
 - community
 - aws (documentdb)
 - ibm</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>According to the <a href="https://www.mongodb.com/support-policy/lifecycles">MongoDB Software Lifecycle Schedules</a> MongoDB 4.4 will reach end of life in February of 2024. Given this fact it is encouraged that either MongoDB 5 or 6 be used for MAS Deployments. The MAS Devops Ansible Collection can be used to install or upgrade MongoDB when the selected service provider is <code>community</code>. If the MonogDB instance used by MAS is hosted by a third party please consult the applicable documentation with respect to MongoDB 5 or 6 options. If the MongoDB instance is hosted on premises please review the appropriate MongoDB documentation related to upgrading. As a best practice it is advised perform MongoDB backups on a regular basis. This is especially important before any upgrade of MongoDB.</p>
</div>
<p>If the selected provider is <code>community</code> then the <a href="https://github.com/mongodb/mongodb-kubernetes-operator">MongoDB Community Kubernetes Operator</a> will be configured and deployed into the specified namespace. By default a three member MongoDB replica set will be created.  The cluster will bind six PVCs, these provide persistence for the data and system logs across the three nodes.  Currently there is no support built-in for customizing the cluster beyond this configuration.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The role will generate a yaml file containing the definition of a Secret and MongoCfg resource that can be used to configure the deployed instance as the MAS system MongoDb.</p>
<p>This file can be directly applied using <code>oc apply -f $MAS_CONFIG_DIR/mongocfg-mongoce-system.yaml</code> or used in conjunction with the <a href="../suite_config/">suite_config</a> role.</p>
</div>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h2>
<p>To run this role with providers as <code>ibm</code> or <code>aws</code> you must have already installed the <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a>.
Also, you need to have AWS user credentials configured via <code>aws configure</code> command or simply export <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with your corresponding AWS username credentials prior running this role when provider is either <code>ibm</code> or <code>aws</code>.</p>
<p>To run the <code>docdb_secret_rotate</code> MONGODB_ACTION when the provider is <code>aws</code> you must have already installed the <a href="https://www.mongodb.com/docs/mongodb-shell/install/">Mongo Shell</a>.</p>
<p>This role will install a GrafanaDashboard used for monitoring the MongoDB instance when the provided is <code>community</code> and you have run the <a href="https://ibm-mas.github.io/ansible-devops/roles/grafana/">grafana role</a> previously. If you did not run the <a href="https://ibm-mas.github.io/ansible-devops/roles/grafana/">grafana role</a> then the GrafanaDashboard won't be installed.</p>
<h2 id="common-role-variables-for-all-providers">Common Role Variables for all providers<a class="headerlink" href="#common-role-variables-for-all-providers" title="Permanent link"></a></h2>
<h3 id="mas_instance_id">mas_instance_id<a class="headerlink" href="#mas_instance_id" title="Permanent link"></a></h3>
<p>The instance ID of Maximo Application Suite that the MongoCfg configuration will target.  If this or <code>mas_config_dir</code> are not set then the role will not generate a MongoCfg template.</p>
<ul>
<li>Environment Variable: <code>MAS_INSTANCE_ID</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mas_config_dir">mas_config_dir<a class="headerlink" href="#mas_config_dir" title="Permanent link"></a></h3>
<p>Local directory to save the generated MongoCfg resource definition.  This can be used to manually configure a MAS instance to connect to the Mongo cluster, or used as an input to the <a href="../suite_config/">suite_config</a> role. If this or <code>mas_instance_id</code> are not set then the role will not generate a MongoCfg template.</p>
<ul>
<li>Environment Variable: <code>MAS_CONFIG_DIR</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mongodb_provider">mongodb_provider<a class="headerlink" href="#mongodb_provider" title="Permanent link"></a></h3>
<p>MongoDB provider</p>
<ul>
<li>Environment variable: <code>MONGODB_PROVIDER</code></li>
<li>Defult Value: <code>community</code></li>
<li>Supported providers: <code>community</code>,<code>aws</code>,<code>ibm</code></li>
</ul>
<h3 id="mongodb_action">mongodb_action<a class="headerlink" href="#mongodb_action" title="Permanent link"></a></h3>
<p>Determines which action needs to be performed w.r.t mongodb for a specfied <code>provider</code></p>
<ul>
<li>Environment variable: <code>MONGODB_ACTION</code></li>
<li>Default Value: <code>install</code>
  ```
  Following Providers supports below mentioned MONGODB_ACTION values:</li>
<li>Provider : community
  Supported MONGODB_ACTION values : install,uninstall</li>
<li>Provider: aws
  Supported MONGODB_ACTION values : install,uninstall,docdb_secret_rotate</li>
<li>Provider: ibm
  Supported MONGODB_ACTION values : install,uninstall,backup,restore,create-mongo-service-credentials
  ```</li>
</ul>
<h2 id="community-mongodb-role-variables">Community MongoDB Role Variables<a class="headerlink" href="#community-mongodb-role-variables" title="Permanent link"></a></h2>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link"></a></h2>
<h3 id="mongodb_namespace">mongodb_namespace<a class="headerlink" href="#mongodb_namespace" title="Permanent link"></a></h3>
<p>The namespace where the operator and MongoDb cluster will be deployed.</p>
<ul>
<li>Environment Variable: <code>MONGODB_NAMESPACE</code></li>
<li>Default Value: <code>mongoce</code></li>
</ul>
<h3 id="mongodb_version">mongodb_version<a class="headerlink" href="#mongodb_version" title="Permanent link"></a></h3>
<p>Defines the specific mongo version to be used. Best practice would be to use the version associated with the current Maximo Application Suite catalog. However, this value can currently be overridden to 4.4.21, 5.0.21, 5.0.23, 6.0.10 or 6.0.12</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is advised to never attempt a downgrade a MongoDB instance managed by the MAS Devops Ansible Collection. Also best practices should include creating scheduled backups of any MongoDB instance.</p>
</div>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>MONGODB_VERSION</code></li>
<li>Default Value: Automatically defined by the mongo version specified in the <a href="https://github.com/ibm-mas/ansible-devops/tree/master/ibm/mas_devops/common_vars/casebundles">latest MAS case bundle available</a>.</li>
</ul>
<h3 id="mongodb_storage_class">mongodb_storage_class<a class="headerlink" href="#mongodb_storage_class" title="Permanent link"></a></h3>
<p>Required.  The name of the storage class to configure the MongoDb operator to use for persistent storage in the MongoDb cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CLASS</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mongodb_storage_capacity_data">mongodb_storage_capacity_data<a class="headerlink" href="#mongodb_storage_capacity_data" title="Permanent link"></a></h3>
<p>The size of the PVC that will be created for data storage in the cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CAPACITY_DATA</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="mongodb_storage_capacity_logs">mongodb_storage_capacity_logs<a class="headerlink" href="#mongodb_storage_capacity_logs" title="Permanent link"></a></h3>
<p>The size of the PVC that will be created for log storage in the cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CAPACITY_LOGS</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="mongodb_cpu_limits">mongodb_cpu_limits<a class="headerlink" href="#mongodb_cpu_limits" title="Permanent link"></a></h3>
<p>The CPU limits on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_CPU_LIMITS</code></li>
<li>Default Value: <code>1</code></li>
</ul>
<h3 id="mongodb_mem_limits">mongodb_mem_limits<a class="headerlink" href="#mongodb_mem_limits" title="Permanent link"></a></h3>
<p>The Memory limits on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_MEM_LIMITS</code></li>
<li>Default Value: <code>1Gi</code></li>
</ul>
<h3 id="mongodb_cpu_requests">mongodb_cpu_requests<a class="headerlink" href="#mongodb_cpu_requests" title="Permanent link"></a></h3>
<p>The CPU requests on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_CPU_REQUESTS</code></li>
<li>Default Value: <code>500m</code></li>
</ul>
<h3 id="mongodb_mem_requests">mongodb_mem_requests<a class="headerlink" href="#mongodb_mem_requests" title="Permanent link"></a></h3>
<p>The Memory requests on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_MEM_REQUESTS</code></li>
<li>Default Value: <code>1Gi</code></li>
</ul>
<h3 id="mongodb_replicas">mongodb_replicas<a class="headerlink" href="#mongodb_replicas" title="Permanent link"></a></h3>
<p>The number of the mongodb replica set members. Default is 3. Set to 1 for SNO Cluster.
- Environment Variable: <code>MONGODB_REPLICAS</code>
- Default Value: <code>3</code></p>
<h3 id="custom_labels">custom_labels<a class="headerlink" href="#custom_labels" title="Permanent link"></a></h3>
<p>List of comma separated key=value pairs for setting custom labels on instance specific resources.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CUSTOM_LABELS</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mongodb_v5_upgrade">mongodb_v5_upgrade<a class="headerlink" href="#mongodb_v5_upgrade" title="Permanent link"></a></h3>
<p>Set this to <code>true</code> to confirm you want to upgrade your existing Mongo instance from version 4.2 or 4.4 to version 5.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>MONGODB_V5_UPGRADE</code></li>
<li>Default Value: <code>false</code></li>
</ul>
<h3 id="mongodb_v6_upgrade">mongodb_v6_upgrade<a class="headerlink" href="#mongodb_v6_upgrade" title="Permanent link"></a></h3>
<p>Set this to <code>true</code> to confirm you want to upgrade your existing Mongo instance from version 5 to version 6.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>MONGODB_V5_UPGRADE</code></li>
<li>Default Value: <code>false</code></li>
</ul>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    mongodb_storage_class: ibmc-block-gold
    mas_instance_id: masinst1
    mas_config_dir: ~/masconfig
  roles:
    - ibm.mas_devops.mongodb
</code></pre>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link"></a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please be cautious while performing any of the troubleshooting steps outlined below. It is important to understand that the MongoDB Community operator persists data within Persistent Volume Claims. These claims should not be removed inadvertent deletion of the <code>mongoce</code> namespace could result in data loss.</p>
</div>
<h3 id="mongodb-replica-set-pods-will-not-start">MongoDB Replica Set Pods Will Not Start<a class="headerlink" href="#mongodb-replica-set-pods-will-not-start" title="Permanent link"></a></h3>
<p>MongoDB 5 has introduced new platform specific requirements. Please consult the <a href="https://www.mongodb.com/docs/manual/administration/production-notes/#x86_64">Platform Support Notes</a> for detailed information.</p>
<p>It is of particular importance to confirm that the AVX instruction set is exposed or available to the MongoDB workloads. This can easily be determined by entering any running pod on the same OpenShift cluster where MongoDB replica set members are failing to start. Once inside of a running pod the following command can be executed to confirm if the AVX instruction set is available:</p>
<pre><code class="language-bash">cat /proc/cpuinfo | grep flags | grep avx
</code></pre>
<p>If <code>avx</code> is not found in the available <code>flags</code> then either the physical processor hosting the OpenShift cluster does not provide the AVX instruction set or the virtual host configuration is not exposing the AVX instruction set. If the latter is suspected the virtual hosting documentation should be referenced for details on how to expose the AVX instruction set.</p>
<h3 id="ca-certificate-renewal">CA Certificate Renewal<a class="headerlink" href="#ca-certificate-renewal" title="Permanent link"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the MongoDB CA Certificate expires the MongoDB replica set will become unusable. Replica set members will not be able to communicate with each other and client applications (i.e. Maximo Application Suite components) will not be to connect.</p>
</div>
<p>In order to renew the CA Certificate used by the MongoDB replica set the following steps must be taken:</p>
<ul>
<li>Delete the CA Certificate resource</li>
<li>Delete the MongoDB server Certificate resource</li>
<li>Delete the Secrets resources associated with both the CA Certificate and Server Certificate</li>
<li>Delete the Secret resource which contains the MongoDB configuration parameters</li>
<li>Delete the ConfigMap resources which contains the CA certificate</li>
<li>Delete the Secret resource which contains the sever certificate and private key</li>
</ul>
<p>The following steps illustrate the process required to renew the CA Certificate, sever certificate and reconfigure the MongoDB replica set with the new CA and server certificates.</p>
<p>The first step is to stop the Mongo replica set and MongoDb CE Operator pod.</p>
<pre><code class="language-bash">oc project mongoce
oc delete deployment mongodb-kubernetes-operator
</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure the MongoDB Community operator pod has terminated before proceeding.</p>
</div>
<pre><code class="language-bash">oc delete statefulset mas-mongo-ce

</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure all pods in the <code>mongoce</code> namespace have terminated before proceeding</p>
</div>
<p>Remove expired CA Certificate and Server Certificate resources. Clean up MongoDB Community configuration and then run the <code>mongodb</code> role.</p>
<pre><code class="language-bash">oc delete certificate mongo-ca-crt
oc delete certificate mongo-server
oc delete secret mongo-ca-secret
oc delete secret mongo-server-cert

oc delete secret mas-mongo-ce-config
oc delete configmap  mas-mongo-ce-cert-map
oc delete secret mas-mongo-ce-server-certificate-key

export ROLE_NAME=mongodb
ansible-playbook ibm.mas_devops.run_role
</code></pre>
<p>Once the <code>mongodb</code> role has completed the MongoDb CE Operator pod and Mongo replica set should be configured.</p>
<p>After the CA and server Certificates have been renewed you must ensure that that MongoCfg Suite CR is updated with the new CA Certificate. First obtain the CA Certificate from the Secret resource <code>mongo-ca-secret</code>. Then edit the Suite MongoCfg CR in the Maximo Application Suite core namespace. This is done by updating the appropriate certificate under <code>.spec.certificates</code> in the MongoCfg CR:</p>
<pre><code class="language-yaml">  spec:
    certificates:
    - alias: ca
      crt: |
        -----BEGIN CERTIFICATE-----

        -----END CERTIFICATE-----

</code></pre>
<p>If an IBM Suite Licensing Service (SLS) is also connecting to the MongoDB replica set the LicenseService CR must also be updated to reflect the new MongoDB CA. This can be added to the <code>.spec.mongo.certificates</code> section of the LicenseService CR.</p>
<pre><code class="language-yaml">    mongo:
      certificates:
      - alias: mongoca
        crt: |
          -----BEGIN CERTIFICATE-----

          -----END CERTIFICATE-----
</code></pre>
<p>Once the CA certificate has been updated for the MongoCfg and LicenseService CRs several pods in the core and SLS namespaces might need to be restarted to pick up the changes. This would include but is not limited to coreidp, coreapi, api-licensing.</p>
<h2 id="ibm-cloud-mongodb-role-variables">IBM Cloud MongoDB Role Variables<a class="headerlink" href="#ibm-cloud-mongodb-role-variables" title="Permanent link"></a></h2>
<h3 id="ibm_mongo_name">ibm_mongo_name<a class="headerlink" href="#ibm_mongo_name" title="Permanent link"></a></h3>
<p>Required. IBM Cloud Mongo database instance name.</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_NAME</code></li>
<li>Default Value: <code>mongo-${MAS_INSTANCE_ID}</code></li>
</ul>
<h3 id="ibm_mongo_admin_password">ibm_mongo_admin_password<a class="headerlink" href="#ibm_mongo_admin_password" title="Permanent link"></a></h3>
<p>Optional. Sets IBM Cloud Mongo database administrator user password.
If not set, an auto-generated 20 character length string will be used.</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_ADMIN_PASSWORD</code></li>
<li>Default Value: None.</li>
</ul>
<h3 id="ibm_mongo_admin_credentials_secret_name">ibm_mongo_admin_credentials_secret_name<a class="headerlink" href="#ibm_mongo_admin_credentials_secret_name" title="Permanent link"></a></h3>
<p>Secret for MongoDB Admin credentials.</p>
<ul>
<li>Secret Name: <code>&lt;mongo-name&gt;-admin-credentials</code></li>
</ul>
<h3 id="ibm_mongo_service_credentials_secret_name">ibm_mongo_service_credentials_secret_name<a class="headerlink" href="#ibm_mongo_service_credentials_secret_name" title="Permanent link"></a></h3>
<p>Secret for MongoDB Service credentials.</p>
<ul>
<li>Secret Name: <code>&lt;mongo-name&gt;-service-credentials</code></li>
</ul>
<h3 id="ibm_mongo_resourcegroup">ibm_mongo_resourcegroup<a class="headerlink" href="#ibm_mongo_resourcegroup" title="Permanent link"></a></h3>
<p>Required.IBM Cloud Resource Group under which resource group will be created.</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_RESOURCEGROUP</code></li>
<li>Default Value: <code>Default</code></li>
</ul>
<h3 id="ibm_mongo_region">ibm_mongo_region<a class="headerlink" href="#ibm_mongo_region" title="Permanent link"></a></h3>
<p>Required.IBM Cloud region where MongoDB resources will be created.</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_REGION</code></li>
<li>Default Value: <code>us-east</code></li>
</ul>
<h3 id="ibmcloud_apikey">ibmcloud_apikey<a class="headerlink" href="#ibmcloud_apikey" title="Permanent link"></a></h3>
<p>Required.IBM Cloud API Key.</p>
<ul>
<li>Environment Variable: <code>IBMCLOUD_APIKEY</code></li>
</ul>
<h3 id="ibm_mongo_plan">ibm_mongo_plan<a class="headerlink" href="#ibm_mongo_plan" title="Permanent link"></a></h3>
<p>Plan name for this IBMCloud Service.</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_PLAN</code></li>
<li>Default Value: <code>standard</code></li>
</ul>
<h3 id="ibm_mongo_service">ibm_mongo_service<a class="headerlink" href="#ibm_mongo_service" title="Permanent link"></a></h3>
<p>IBMCloud Offering name for MongoDB Database</p>
<ul>
<li>Value: <code>databases-for-mongodb</code></li>
</ul>
<h3 id="ibm_mongo_service_endpoints">ibm_mongo_service_endpoints<a class="headerlink" href="#ibm_mongo_service_endpoints" title="Permanent link"></a></h3>
<p>MongoDB Service Endpoints type can be either public or private</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_SERVICE_ENDPOINTS</code></li>
<li>Default Value: <code>public</code></li>
</ul>
<h3 id="ibm_mongo_version">ibm_mongo_version<a class="headerlink" href="#ibm_mongo_version" title="Permanent link"></a></h3>
<p>Specify MongoDB version to be deployed</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_VERSION</code></li>
<li>Default Value: <code>4.2</code></li>
</ul>
<h3 id="ibm_mongo_memory">ibm_mongo_memory<a class="headerlink" href="#ibm_mongo_memory" title="Permanent link"></a></h3>
<p>Specify MongoDB Memory size</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_MEMORY</code></li>
<li>Default Value: <code>3840</code></li>
</ul>
<h3 id="ibm_mongo_disk">ibm_mongo_disk<a class="headerlink" href="#ibm_mongo_disk" title="Permanent link"></a></h3>
<p>Specify MongoDB Disk size</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_DISK</code></li>
<li>Default Value: <code>30720</code></li>
</ul>
<h3 id="ibm_mongo_cpu">ibm_mongo_cpu<a class="headerlink" href="#ibm_mongo_cpu" title="Permanent link"></a></h3>
<p>Specify MongoDB CPU</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_CPU</code></li>
<li>Default Value: <code>0</code></li>
</ul>
<h3 id="ibm_mongo_name_1">ibm_mongo_name<a class="headerlink" href="#ibm_mongo_name_1" title="Permanent link"></a></h3>
<p>Resource Name in IBMCloud for MongoDB</p>
<ul>
<li>Value: <code>mongo-{{mas_instance_id}}</code></li>
</ul>
<h3 id="ibm_mongo_backup_id">ibm_mongo_backup_id<a class="headerlink" href="#ibm_mongo_backup_id" title="Permanent link"></a></h3>
<p>Required only if <code>is_restore</code> is <code>True</code> CRN ID for backup resource</p>
<ul>
<li>Environment Variable: <code>IBM_MONGO_BACKUP_ID</code></li>
<li>Default Value: ``</li>
</ul>
<h3 id="is_restore">is_restore<a class="headerlink" href="#is_restore" title="Permanent link"></a></h3>
<p>Whether want to restore from an existing backup resource or not.</p>
<ul>
<li>Environment Variable: <code>IS_RESTORE</code></li>
<li>Default Value: <code>false</code></li>
</ul>
<h3 id="restored_mongodb_service_name">restored_mongodb_service_name<a class="headerlink" href="#restored_mongodb_service_name" title="Permanent link"></a></h3>
<p>Required only If <code>is_restore</code> is <code>True</code>.MongoDB Service Name</p>
<ul>
<li>Environment Variable: <code>RESTORED_MONGODB_SERVICE_NAME</code></li>
</ul>
<h2 id="example-playbook_1">Example Playbook<a class="headerlink" href="#example-playbook_1" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    mas_instance_id: masinst1
    mas_config_dir: ~/masconfig
    mongodb_provider: ibm
    ibmcloud_apikey: apikey****
    ibmcloud_resource_group: mas-test
  roles:
    - ibm.mas_devops.mongodb
</code></pre>
<h2 id="aws-documentdb-role-variables">AWS DocumentDB Role Variables<a class="headerlink" href="#aws-documentdb-role-variables" title="Permanent link"></a></h2>
<h3 id="aws_access_key_id">aws_access_key_id<a class="headerlink" href="#aws_access_key_id" title="Permanent link"></a></h3>
<p>Required.AWS Account Access Key Id</p>
<ul>
<li>Environment Variable: <code>AWS_ACCESS_KEY_ID</code></li>
</ul>
<h3 id="aws_secret_access_key">aws_secret_access_key<a class="headerlink" href="#aws_secret_access_key" title="Permanent link"></a></h3>
<p>Required.AWS Account Secret Access Key</p>
<ul>
<li>Environment Variable: <code>AWS_SECRET_ACCESS_KEY</code></li>
</ul>
<h3 id="aws_region">aws_region<a class="headerlink" href="#aws_region" title="Permanent link"></a></h3>
<p>Required.AWS Region where DocumentDB and other resources will be created</p>
<ul>
<li>Environment Variable: <code>AWS_REGION</code></li>
<li>Default Value: <code>us-east-2</code></li>
</ul>
<h3 id="vpc_id">vpc_id<a class="headerlink" href="#vpc_id" title="Permanent link"></a></h3>
<p>Required.AWS VPC ID under which documentdb,subnets and security group will be created</p>
<ul>
<li>Environment Variable: <code>VPC_ID</code></li>
</ul>
<h3 id="docdb_cluster_name">docdb_cluster_name<a class="headerlink" href="#docdb_cluster_name" title="Permanent link"></a></h3>
<p>Required.DocumentDB Cluster Name</p>
<ul>
<li>Environment Variable: <code>DOCDB_CLUSTER_NAME</code></li>
</ul>
<h3 id="docdb_subnet_group_name">docdb_subnet_group_name<a class="headerlink" href="#docdb_subnet_group_name" title="Permanent link"></a></h3>
<p>DocumentDB Subnet Group Name</p>
<ul>
<li>Value: <code>docdb-{{ docdb_cluster_name }}</code></li>
</ul>
<h3 id="docdb_security_group_name">docdb_security_group_name<a class="headerlink" href="#docdb_security_group_name" title="Permanent link"></a></h3>
<p>DocumentDB Security Group Name</p>
<ul>
<li>Value: <code>docdb-{{ docdb_cluster_name }}</code></li>
</ul>
<h3 id="docdb_admin_credentials_secret_name">docdb_admin_credentials_secret_name<a class="headerlink" href="#docdb_admin_credentials_secret_name" title="Permanent link"></a></h3>
<p>DocumentDB Admin Credentials Secret Name</p>
<ul>
<li>Value: <code>{{ docdb_cluster_name }}-admin-credentials</code></li>
</ul>
<h3 id="docdb_engine_version">docdb_engine_version<a class="headerlink" href="#docdb_engine_version" title="Permanent link"></a></h3>
<p>DocumentDB Engine version</p>
<ul>
<li>Environment variable: <code>DOCDB_ENGINE_VERSION</code></li>
<li>Default Value: <code>4.0.0</code></li>
</ul>
<h3 id="docdb_master_username">docdb_master_username<a class="headerlink" href="#docdb_master_username" title="Permanent link"></a></h3>
<p>DocumentDB master username</p>
<ul>
<li>Environment variable: <code>DOCDB_MASTER_USERNAME</code></li>
<li>Default Value: <code>docdbadmin</code></li>
</ul>
<h3 id="docdb_instance_class">docdb_instance_class<a class="headerlink" href="#docdb_instance_class" title="Permanent link"></a></h3>
<p>DocumentDB Instance Class</p>
<ul>
<li>Environment variable: <code>DOCDB_INSTANCE_CLASS</code></li>
<li>Default Value: <code>db.t3.medium</code></li>
</ul>
<h3 id="docdb_instance_number">docdb_instance_number<a class="headerlink" href="#docdb_instance_number" title="Permanent link"></a></h3>
<p>Number of instances required for DocumentDB</p>
<ul>
<li>Environment variable: <code>DOCDB_INSTANCE_NUMBER</code></li>
<li>Default Value: <code>3</code></li>
</ul>
<h3 id="docdb_instance_identifier_prefix">docdb_instance_identifier_prefix<a class="headerlink" href="#docdb_instance_identifier_prefix" title="Permanent link"></a></h3>
<p>Required. Prefix for DocumentDB Instance name</p>
<ul>
<li>Environment variable: <code>DOCDB_INSTANCE_IDENTIFIER_PREFIX</code></li>
</ul>
<h3 id="docdb_ingress_cidr">docdb_ingress_cidr<a class="headerlink" href="#docdb_ingress_cidr" title="Permanent link"></a></h3>
<p>Required. IPv4 Address from which incoming connection requests will be allowed to DocumentDB cluster
e.g Provide IPv4 CIDR address of VPC where ROSA cluster is installed</p>
<ul>
<li>Environment variable: <code>DOCDB_INGRESS_CIDR</code></li>
</ul>
<h3 id="docdb_egress_cidr">docdb_egress_cidr<a class="headerlink" href="#docdb_egress_cidr" title="Permanent link"></a></h3>
<p>Required. IPv4 Address at which outgoing connection requests will be allowed to DocumentDB cluster
e.g Provide IPv4 CIDR address of VPC where ROSA cluster is installed</p>
<ul>
<li>Environment variable: <code>DOCDB_EGRESS_CIDR</code></li>
</ul>
<h3 id="docdb_cidr_az1">docdb_cidr_az1:<a class="headerlink" href="#docdb_cidr_az1" title="Permanent link"></a></h3>
<p>Required. Provide IPv4 CIDR address for the subnet to be created in one of the 3 availabilty zones of your VPC. If the subnet exists already then it must contain the tag of Name: {{ docdb_cluster_name }}, if the subnet doesn't exist already then one is created.</p>
<ul>
<li>Environment variable: <code>DOCDB_CIDR_AZ1</code></li>
</ul>
<h3 id="docdb_cidr_az2">docdb_cidr_az2:<a class="headerlink" href="#docdb_cidr_az2" title="Permanent link"></a></h3>
<p>Required. Provide IPv4 CIDR address for the subnet to be created in one of the 3 availabilty zones of your VPC. If the subnet exists already then it must contain the tag of Name: {{ docdb_cluster_name }}, if the subnet doesn't exist already then one is created.</p>
<ul>
<li>Environment variable: <code>DOCDB_CIDR_AZ2</code></li>
</ul>
<h3 id="docdb_cidr_az3">docdb_cidr_az3:<a class="headerlink" href="#docdb_cidr_az3" title="Permanent link"></a></h3>
<p>Required. Provide IPv4 CIDR address for the subnet to be created in one of the 3 availabilty zones of your VPC. If the subnet exists already then it must contain the tag of Name: {{ docdb_cluster_name }}, if the subnet doesn't exist already then one is created.</p>
<ul>
<li>Environment variable: <code>DOCDB_CIDR_AZ3</code></li>
</ul>
<h2 id="example-playbook_2">Example Playbook<a class="headerlink" href="#example-playbook_2" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    mas_instance_id: masinst1
    mas_config_dir: ~/masconfig
    mongodb_provider: aws
    mongodb_action: provision
    docdb_size: ~/docdb-config.yml
    docdb_cluster_name: test-db
    docdb_ingress_cidr: 10.0.0.0/16
    docdb_egress_cidr: 10.0.0.0/16
    docdb_cidr_az1: 10.0.0.0/26
    docdb_cidr_az2: 10.0.0.64/26
    docdb_cidr_az3: 10.0.0.128/26
    docdb_instance_identifier_prefix: test-db-instance
    vpc_id: test-vpc-id
    aws_access_key_id: aws-key
    aws_secret_access_key: aws-access-key

  roles:
    - ibm.mas_devops.mongodb
</code></pre>
<h2 id="aws-documentdb-secret-rotate-role-variables">AWS DocumentDB Secret Rotate role Variables<a class="headerlink" href="#aws-documentdb-secret-rotate-role-variables" title="Permanent link"></a></h2>
<h3 id="docdb_mongo_instance_name">docdb_mongo_instance_name<a class="headerlink" href="#docdb_mongo_instance_name" title="Permanent link"></a></h3>
<p>Required. DocumentDB Instance Name</p>
<ul>
<li>Environment variable: <code>DOCDB_MONGO_INSTANCE_NAME</code></li>
</ul>
<h3 id="docdb_host">docdb_host<a class="headerlink" href="#docdb_host" title="Permanent link"></a></h3>
<p>Required. Any one Host Address out of multiple documentDB Instances</p>
<ul>
<li>Environment variable: <code>DOCDB_HOST</code></li>
</ul>
<h3 id="docdb_port">docdb_port<a class="headerlink" href="#docdb_port" title="Permanent link"></a></h3>
<p>Required. Corresponding port address of DocumentDB Instance Host</p>
<ul>
<li>Environment variable: <code>DOCDB_PORT</code></li>
</ul>
<h3 id="docdb_instance_username">docdb_instance_username<a class="headerlink" href="#docdb_instance_username" title="Permanent link"></a></h3>
<p>Required. Specify username for which password is being changed</p>
<ul>
<li>Environment variable: <code>DOCDB_INSTANCE_USERNAME</code></li>
</ul>
<h3 id="docdb_instance_password_old">docdb_instance_password_old<a class="headerlink" href="#docdb_instance_password_old" title="Permanent link"></a></h3>
<p>Required. Specify the old user password</p>
<ul>
<li>Environment variable: <code>DOCDB_PASSWORD_OLD</code></li>
</ul>
<h3 id="docdb_master_password">docdb_master_password<a class="headerlink" href="#docdb_master_password" title="Permanent link"></a></h3>
<p>Required. DocumentDB Master Username</p>
<ul>
<li>Environment variable: <code>DOCDB_MASTER_PASSWORD</code></li>
</ul>
<h3 id="docdb_master_username_1">docdb_master_username<a class="headerlink" href="#docdb_master_username_1" title="Permanent link"></a></h3>
<p>Required. DocumentDB Master Password</p>
<ul>
<li>Environment variable: <code>DOCDB_MASTER_USERNAME</code></li>
</ul>
<h2 id="example-playbook_3">Example Playbook<a class="headerlink" href="#example-playbook_3" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    mas_instance_id: masinst1
    mas_config_dir: ~/masconfig
    mongodb_provider: aws
    mongodb_action: docdb_secret_rotate
    docdb_mongo_instance_name: test-db-instance
    db_host: aws.test1.host7283-*****
    db_port: 27017
    docdb_master_username: admin
    docdb_master_password: pass***
    docdb_instance_password_old: oldpass****
    docdb_instance_username: testuser
    aws_access_key_id: aws-key
    aws_secret_access_key: aws-access-key

  roles:
    - ibm.mas_devops.mongodb
</code></pre>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../nvidia_gpu/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ocs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
