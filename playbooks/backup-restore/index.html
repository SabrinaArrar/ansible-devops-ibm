<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/playbooks/backup-restore/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Backup & Restore - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Backup \u0026 Restore";
        var mkdocs_page_input_path = "playbooks/backup-restore.md";
        var mkdocs_page_url = "/ansible-devops/playbooks/backup-restore/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../execution-environment/">Execution Environment</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d/">Install Cloud Pak For Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-aibroker/">Add AIBroker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-iot/">Add IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-manage/">Add Manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-monitor/">Add Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-optimizer/">Add Optimizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-predict/">Add Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-visualinspection/">Add Visual Inspection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oneclick-upgrade/">Upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uninstall-core/">Uninstall Core</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Backup & Restore</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#storage">Storage</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#use-local-folder">Use Local Folder</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#use-cloud-object-storage">Use Cloud Object Storage</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#kubernetes-jobs">Kubernetes Jobs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backups">Backups</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#full-backups">Full Backups</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#incremental-backups">Incremental Backups</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#scheduled-backups">Scheduled Backups</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restore">Restore</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#slack-notifications">Slack Notifications</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-mongodb">Backup/Restore for MongoDB</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-db2">Backup/Restore for Db2</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_1">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_1">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-mas-core">Backup/Restore for MAS Core</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_2">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_2">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-manage">Backup/Restore for Manage</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_3">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_3">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-iot">Backup/Restore for IoT</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_4">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_4">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-monitor">Backup/Restore for Monitor</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_5">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_5">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-health">Backup/Restore for Health</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_6">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_6">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-optimizer">Backup/Restore for Optimizer</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_7">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_7">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backuprestore-for-visual-inspection">Backup/Restore for Visual Inspection</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables_8">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#examples_8">Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reference">Reference</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#directory-structure">Directory Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-model">Data Model</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#backupyml">backup.yml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#restoreyml">restore.yml</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_cluster_monitoring/">ocp_cluster_monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_config/">ocp_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_efs/">ocp_efs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_node_config/">ocp_node_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_bucket_access_point/">aws_bucket_access_point</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_documentdb_user/">aws_documentdb_user</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_policy/">aws_policy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_route53/">aws_route53</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_user_creation/">aws_user_creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/aws_vpc/">aws_vpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cis/">cis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/common_services/">common-services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/configure_manage_eventstreams/">configure_manage_eventstreams</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cos_bucket/">cos_bucket</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cp4d_admin_pwd_update/">cp4d_admin_pwd_update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cp4d/">cp4d</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/cp4d_service/">cp4d_service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/dro/">dro</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/eck/">eck</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/grafana/">grafana</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ibm_catalogs/">ibm_catalogs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/mongodb/">mongodb</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/turbonomic/">turbonomic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Image Mirroring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/mirror_case_prepare/">mirror_case_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/mirror_extras_prepare/">mirror_extras_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/mirror_images/">mirror_images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/mirror_ocp/">mirror_ocp</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_contentsourcepolicy/">ocp_contentsourcepolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ocp_simulate_disconnected_network/">ocp_simulate_disconnected_network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/registry/">registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_uninstall/">suite_app_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_upgrade/">suite_app_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_rollback/">suite_app_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_certs/">suite_certs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_dns/">suite_dns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_attachments_config/">suite_manage_attachments_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_birt_report_config/">suite_manage_birt_report_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_bim_config/">suite_manage_bim_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_customer_files_config/">suite_manage_customer_files_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_import_certs_config/">suite_manage_import_certs_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_load_dbc_scripts/">suite_manage_load_dbc_scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_logging_config/">suite_manage_logging_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_manage_pvc_config/">suite_manage_pvc_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_uninstall/">suite_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_rollback/">suite_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_verify/">suite_verify</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/suite_backup_restore/">suite_backup_restore</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/entitlement_key_rotation/">entitlement_key_rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/gencfg_watsonstudio/">gencfg_watsonstudio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/install_operator/">install_operator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../roles/gencfg_mongo/">gencfg_mongo</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Playbooks</li>
      <li class="breadcrumb-item active">Backup & Restore</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/playbooks/backup-restore.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="backup-and-restore">Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permanent link"></a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link"></a></h2>
<p>MAS Devops Collection includes playbooks for backing up and restoring of the following MAS components and their dependencies:</p>
<ul>
<li><a href="#backuprestore-for-mongodb">MongoDB</a></li>
<li><a href="#backuprestore-for-db2">Db2</a></li>
<li><a href="#backuprestore-for-mas-core">MAS Core</a></li>
<li><a href="#backuprestore-for-manage">Manage</a></li>
<li><a href="#backuprestore-for-iot">IoT</a></li>
<li><a href="#backuprestore-for-monitor">Monitor</a></li>
<li><a href="#backuprestore-for-health">Health</a></li>
<li><a href="#backuprestore-for-optimizer">Optimizer</a></li>
<li><a href="#backuprestore-for-visual-inspection">Visual Inspection</a></li>
</ul>
<p>Creation of both <strong>full</strong> and <strong>incremental</strong> backups are supported. Backup and restore actions can be executed locally, or by generating <strong>on-demand</strong> or <strong>scheduled</strong> jobs that will allow the work to be performed on your OpenShift cluster using the <a href="https://github.ibm.com/ibm-mas/cli">MAS CLI container image</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The backup and restore Ansible roles can also be used individually, allowing you to build your own customized backup and restore playbook covering exactly what you need. For example, you can only <a href="../../roles/suite_app_backup_restore/">backup/restore Manage attachments</a>.</p>
</div>
<p>For more information about backup and restore for Maximo Application Suite, please refer to <a href="https://www.ibm.com/docs/en/mas-cd/continuous-delivery?topic=administering-backing-up-restoring-maximo-application-suite">Backing up and restoring Maximo Application Suite</a> in the product documentation.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link"></a></h2>
<h3 id="storage">Storage<a class="headerlink" href="#storage" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Envrionment variable</th>
<th>Required (Default Value)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MASBR_STORAGE_TYPE</td>
<td><strong>Yes</strong></td>
<td>Type of storage system for saving the backup files</td>
</tr>
<tr>
<td>MASBR_STORAGE_LOCAL_FOLDER</td>
<td><strong>Yes</strong>, if <code>MASBR_STORAGE_TYPE=local</code></td>
<td>The local path to save the backup files</td>
</tr>
<tr>
<td>MASBR_STORAGE_CLOUD_RCLONE_FILE</td>
<td><strong>Yes</strong>, if <code>MASBR_STORAGE_TYPE=cloud</code></td>
<td>The path of <code>rclone.conf</code> file</td>
</tr>
<tr>
<td>MASBR_STORAGE_CLOUD_RCLONE_NAME</td>
<td><strong>Yes</strong> if <code>MASBR_STORAGE_TYPE=cloud</code></td>
<td>The configuration name defined in <code>rclone.conf</code> file</td>
</tr>
<tr>
<td>MASBR_STORAGE_CLOUD_BUCKET</td>
<td><strong>Yes</strong>, if <code>MASBR_STORAGE_TYPE=cloud</code></td>
<td>Object storage bucket for saving backup files</td>
</tr>
<tr>
<td>MASBR_LOCAL_TEMP_FOLDER</td>
<td>No (<code>/tmp/masbr</code>)</td>
<td>Local folder for saving the temporary backup/restore data, the data in this folder will be deleted after the backup/restore job completed.</td>
</tr>
</tbody>
</table>
<p>You need to set the environment variable <code>MASBR_STORAGE_TYPE</code> before you perform a backup or restore job. This variable indicates what type of storage systems that you are using for saving the backup files. Currently, it supports below types:</p>
<ul>
<li><code>local</code>: use the local file system, e.g. a folder on your laptop or workstation.</li>
<li><code>cloud</code>: use the cloud object storage, such as IBM Cloud Object Storage, AWS S3, etc.</li>
</ul>
<h6 id="use-local-folder">Use Local Folder<a class="headerlink" href="#use-local-folder" title="Permanent link"></a></h6>
<p>You can save the backup files to a folder on your local file system by setting the following environment variables: </p>
<pre><code>MASBR_STORAGE_TYPE=local
MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
</code></pre>
<ul>
<li><code>MASBR_STORAGE_LOCAL_FOLDER</code>: the path for saving the backup files</li>
</ul>
<h6 id="use-cloud-object-storage">Use Cloud Object Storage<a class="headerlink" href="#use-cloud-object-storage" title="Permanent link"></a></h6>
<p>The backup playbooks use <a href="https://rclone.org/">Rclone</a> to copy backup files from data stores to cloud object storage. It requires a Rclone configuration file which you can either create it manually, or you can install the Rclone tool and create the configuration file by running the <code>rclone config</code> command. For more information about the rclone config command and configuration file format, please refer to the <a href="https://rclone.org/s3/#configuration">Rclone documentation</a>. </p>
<p>Below is a sample Rclone configuration file that using MinIO object storage:</p>
<pre><code>[masbr]
type = s3
provider = Minio
endpoint = http://minio-api.apps.mydomain.com
access_key_id = Qfx9YGnykJapxL7pzUyA
secret_access_key = qKRGSnxsJ7z6pIA74sVxJ6fkEh4Fq5m4fo0inDuJ
region = minio
</code></pre>
<p>Set the following environment variables to indicate the playbooks to use cloud object storage for saving backup files:</p>
<pre><code>MASBR_STORAGE_TYPE=cloud
MASBR_STORAGE_CLOUD_RCLONE_FILE=/mnt/configmap/rclone.conf
MASBR_STORAGE_CLOUD_RCLONE_NAME=masbr
MASBR_STORAGE_CLOUD_BUCKET=mas-backup
</code></pre>
<ul>
<li><code>MASBR_STORAGE_CLOUD_RCLONE_FILE</code>: the path where your rclone.conf file is located</li>
<li><code>MASBR_STORAGE_CLOUD_RCLONE_NAME</code>: the Rclone configuration name (<code>[masbr]</code> from above sample) defined in the rclone.conf file</li>
<li><code>MASBR_STORAGE_CLOUD_BUCKET</code>: the bucket name you created on the object storage for saving the backup files</li>
</ul>
<h3 id="kubernetes-jobs">Kubernetes Jobs<a class="headerlink" href="#kubernetes-jobs" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Envrionment variable</th>
<th>Required (Default Value)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MASBR_CONFIRM_CLUSTER</td>
<td>No (<code>false</code>)</td>
<td>Set <code>true</code> or <code>false</code> to indicate the playbook whether to confirm the currently connected cluster before running the backup or restore job</td>
</tr>
<tr>
<td>MASBR_CREATE_TASK_JOB</td>
<td>No (<code>true</code>)</td>
<td>Whether to run backup/restore process in kubernetes Job</td>
</tr>
<tr>
<td>MASBR_COPY_TIMEOUT_SEC</td>
<td>No (<code>43200</code>)</td>
<td>The transfer files timeout in seconds, default timeout value is 12 hours.</td>
</tr>
<tr>
<td>MASBR_JOB_TIMEZONE</td>
<td>No</td>
<td>The <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">time zone</a> for creating scheduled job. If not set a value for this variable, this role will use UTC time zone when creating a CronJob for running scheduled job.</td>
</tr>
<tr>
<td>MASBR_CLEANUP_SCHEDULE</td>
<td>No (<code>0 1 * * *</code>)</td>
<td>Cron expression of cleanup Job (default to run at 1:00 every day)</td>
</tr>
<tr>
<td>MASBR_CLEANUP_TTL_SEC</td>
<td>No (<code>604800</code>)</td>
<td>All completed jobs that exceed this TTL(time-to-live) in seconds will be deleted (default TTL is 1 week: 3600 * 24 * 7)</td>
</tr>
<tr>
<td>MASBR_MASCLI_IMAGE_TAG</td>
<td>No (<code>latest</code>)</td>
<td>MAS CLI docker image tag</td>
</tr>
<tr>
<td>MASBR_MASCLI_IMAGE_PULL_POLICY</td>
<td>No</td>
<td>MAS CLI docker <a href="https://kubernetes.io/docs/concepts/containers/images/#imagepullpolicy-defaulting">image pull policy</a></td>
</tr>
</tbody>
</table>
<p>When the playbook starts running, it will first perform some checks, such as checking the required environment variables, get the source or target cluster information, etc. Then, depending on the value of <code>MASBR_CREATE_TASK_JOB</code>, the remaining backup/restore process can be ran in different ways:</p>
<ul>
<li><code>MASBR_CREATE_TASK_JOB=false</code>, run backup/restore process in your current terminal, and you can view the terminal output to get the progress of the backup/restore.</li>
<li><code>MASBR_CREATE_TASK_JOB=true</code>, a new kubernetes Job will be created to run the backup/restore process in the cluster, then you can check the log of the created kubernetes Job in the cluster to monitor the backup/restore progress. </li>
</ul>
<p>The environment variable <code>MASBR_CREATE_TASK_JOB</code> is only valid when using cloud object storage (<code>MASBR_STORAGE_TYPE=cloud</code>). The playbooks will always run backup/restore process in your local terminal when using local storage system (<code>MASBR_STORAGE_TYPE=local</code>).</p>
<p>During the backup/restore process, the playbook will copy backup files between different data stores and specified backup storage systems. Set a suitable value for the environment variable <code>MASBR_COPY_TIMEOUT_SEC</code> to avoid the playbook entering a waiting state due to some errors, such as the specified storage system network speed is too slow or cannot be connected.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Set a suitable value for <code>MASBR_COPY_TIMEOUT_SEC</code> based on the estimated size of the backup/restore data and the network conditions, setting it too low can result in the data copying process being interrupted.</p>
</div>
<p>The playbook will create an additional CronJob <code>masbr-cleanup</code> for each namespace that has backup/restore jobs created. This cleanup CronJob will periodically delete the completed jobs that exceed a certain priod of time which specified by <code>MASBR_CLEANUP_TTL_SEC</code>. You can also specify when to run the cleanup CronJob by setting Cron expression for <code>MASBR_CLEANUP_SCHEDULE</code>. </p>
<h3 id="backups">Backups<a class="headerlink" href="#backups" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Envrionment variable</th>
<th>Required (Default Value)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MASBR_ACTION</td>
<td><strong>Yes</strong></td>
<td>Whether to run the playbook to perform a <code>backup</code> or a <code>restore</code></td>
</tr>
<tr>
<td>MASBR_BACKUP_TYPE</td>
<td>No (<code>full</code>)</td>
<td>Set <code>full</code> or <code>incr</code> to indicate the playbook to create a <strong>full</strong> backup or <strong>incremental</strong> backup.</td>
</tr>
<tr>
<td>MASBR_BACKUP_FROM_VERSION</td>
<td>No</td>
<td>Set the full backup version to use in the incremental backup, this will be in the format of a <code>YYYMMDDHHMMSS</code> timestamp (e.g. <code>20240621021316</code>).</td>
</tr>
<tr>
<td>MASBR_BACKUP_SCHEDULE</td>
<td>No</td>
<td>Set <a href="ttps://en.wikipedia.org/wiki/Cron">Cron expression</a> to create a scheduled backup. If not set a value for this varialbe, the playbook will create an on-demand backup.</td>
</tr>
</tbody>
</table>
<p>The playbooks are switched to backup mode by setting <code>MASBR_ACTION</code> to <code>backup</code>.</p>
<h6 id="full-backups">Full Backups<a class="headerlink" href="#full-backups" title="Permanent link"></a></h6>
<p>If you set environment variable <code>MASBR_BACKUP_TYPE=full</code> or do not specify a value for this variable, the playbook will take a full backup. </p>
<h6 id="incremental-backups">Incremental Backups<a class="headerlink" href="#incremental-backups" title="Permanent link"></a></h6>
<p>You can set environment variable <code>MASBR_BACKUP_TYPE=incr</code> to indicate the playbook to take an incremental backup. </p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Only supports creating incremental backup for MonogDB, Db2 and persistent volume data. The playbook will always create a full backup for other type of data regardless of whether this variable be set to <code>incr</code>.</p>
</div>
<p>The environment variable <code>MASBR_BACKUP_FROM_VERSION</code> is only valid if <code>MASBR_BACKUP_TYPE=incr</code>. It indicates which backup version that the incremental backup to based on. If you do not set a value for this variable, the playbook will try to find the latest Completed Full backup from the specified storage location, and then take an incremental backup based on it.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The backup files you specified by <code>MASBR_BACKUP_FROM_VERSION</code> must be a Full backup. And the component name and data types in the specified Full backup file must be same as the current incremental backup job.</p>
</div>
<h6 id="scheduled-backups">Scheduled Backups<a class="headerlink" href="#scheduled-backups" title="Permanent link"></a></h6>
<p>In addition to create an on-demand backup job, you can also set environment variable <code>MASBR_BACKUP_SCHEDULE</code> to indicate the playbook to create a kubernetes CronJob to run the backup process periodically.</p>
<p>The value of <code>MASBR_BACKUP_SCHEDULE</code> is a <a href="https://en.wikipedia.org/wiki/Cron">Cron expression</a>:</p>
<pre><code> ┌───────────── minute (0–59)
 │ ┌───────────── hour (0–23)
 │ │ ┌───────────── day of the month (1–31)
 │ │ │ ┌───────────── month (1–12)
 │ │ │ │ ┌───────────── day of the week (0–6) (Sunday to Saturday;
 │ │ │ │ │                                   7 is also Sunday on some systems)
 │ │ │ │ │
 │ │ │ │ │
 * * * * *
</code></pre>
<p>For example, set below value to create a scheduled backup job that will run at 1:00 a.m. from Monday to Friday:<br />
<code>MASBR_BACKUP_SCHEDULE="0 1 * * 1-5"</code></p>
<p>By default, the kubernetes CronJob use UTC time zone, so maybe you want to set environment variable <code>MASBR_JOB_TIMEZONE</code> with the Cron expression based on your local <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">time zone</a></p>
<h3 id="restore">Restore<a class="headerlink" href="#restore" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Envrionment variable</th>
<th>Required (Default Value)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MASBR_ACTION</td>
<td><strong>Yes</strong></td>
<td>Whether to run the playbook to perform a <code>backup</code> or a <code>restore</code></td>
</tr>
<tr>
<td>MASBR_RESTORE_FROM_VERSION</td>
<td><strong>Yes</strong></td>
<td>Set the backup version to use in the restore, this will be in the format of a <code>YYYMMDDHHMMSS</code> timestamp (e.g. <code>20240621021316</code>)</td>
</tr>
</tbody>
</table>
<p>The playbooks are switched to restore mode by setting <code>MASBR_ACTION</code> to <code>restore</code>. You <strong>must</strong> specify the <code>MASBR_RESTORE_FROM_VERSION</code> environment variable to indicate which version of the backup files to use.</p>
<p>In the case of restoring from an incremental backup, the corresponding full backup will be restored first before continuing to restore the incremental backup.</p>
<h3 id="slack-notifications">Slack Notifications<a class="headerlink" href="#slack-notifications" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Envrionment variable</th>
<th>Required (Default Value)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MASBR_SLACK_ENABLED</td>
<td>No (<code>false</code>)</td>
<td>Set <code>true</code> or <code>false</code> to indicate whether the playbook will send Slack notification messages of the backup and restore progress</td>
</tr>
<tr>
<td>MASBR_SLACK_LEVEL</td>
<td>No (<code>info</code>)</td>
<td>Set <code>failure</code>, <code>info</code> or <code>verbose</code> to indicate the playbook to send Slack notification messages in which backup and resore phases</td>
</tr>
<tr>
<td>MASBR_SLACK_TOKEN</td>
<td>Yes, if <code>MASBR_SLACK_ENABLED=true</code></td>
<td>Slack integration token</td>
</tr>
<tr>
<td>MASBR_SLACK_CHANNEL</td>
<td>Yes, if <code>MASBR_SLACK_ENABLED=true</code></td>
<td>Channel to send the message to</td>
</tr>
<tr>
<td>MASBR_SLACK_USER</td>
<td>No (<code>MASBR</code>)</td>
<td>Sender of the message</td>
</tr>
</tbody>
</table>
<p>Integration with Slack is supported with below notification levels:</p>
<ul>
<li><code>verbose</code>: send notifications when job in the phase <code>InProgress</code>, <code>Completed</code>, <code>Failed</code> or <code>PartiallyFailed</code>.</li>
<li><code>info</code>: send notifications when job in the phase <code>Completed</code>, <code>Failed</code> or <code>PartiallyFailed</code>.</li>
<li><code>failure</code>: send notifications only when job in the phase <code>Failed</code> or <code>PartiallyFailed</code></li>
</ul>
<h2 id="backuprestore-for-mongodb">Backup/Restore for MongoDB<a class="headerlink" href="#backuprestore-for-mongodb" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_mongodb</code> will invoke the role <a href="../../roles/mongodb/">mongodb</a> to backup/restore the MongoDB databases.</p>
<p>This playbook supports backing up and restoring databases for an in-cluster MongoDB CE instance. If you are using other MongoDB venders, such as IBM Cloud Databases for MongoDB, Amazon DocumentDB or MongoDB Altas Database, please refer to the corresponding vender's documentation for more information about their provided backup/restore service.</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code>: <strong>Required</strong>. This playbook supports backup/restore MongoDB databases that belong to a specific MAS instance, call the playbook multiple times with different values for <code>MAS_INSTANCE_ID</code> if you wish to back up multiple MAS instances that use the same MongoDB CE instance.</li>
<li><code>MAS_APP_ID</code>: <strong>Optional</strong>. By default, this playbook will backup all databases belonging to the specified MAS instance. You can backup the databases only belong to a specific MAS application by setting this environment variable to a supported MAS application id <code>core</code>, <code>manage</code>, <code>iot</code>, <code>monitor</code>, <code>health</code>, <code>optimizer</code> or <code>visualinspection</code>.</li>
</ul>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all MongoDB data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_mongodb

# Incremental backup all MongoDB data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_mongodb

# Create a scheduled backup Job for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_SCHEDULE=&quot;50 0 * * *&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_mongodb

# Restore all MongoDB data for the dev1 instance
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_mongodb

# Backup just the IoT MongoDB data for the dev2 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev2
export MAS_APP_ID=iot
ansible-playbook ibm.mas_devops.br_mongodb
</code></pre>
<h2 id="backuprestore-for-db2">Backup/Restore for Db2<a class="headerlink" href="#backuprestore-for-db2" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_db2</code> will invoke the role <a href="../../roles/db2/">db2</a> to backup/restore Db2 instance.</p>
<h3 id="environment-variables_1">Environment Variables<a class="headerlink" href="#environment-variables_1" title="Permanent link"></a></h3>
<ul>
<li><code>DB2_INSTANCE_NAME</code>: <strong>Required</strong>. This playbook only supports backing up specific Db2 instance at a time. If you want to backup all Db2 instances in the Db2 cluster, you need to run this playbook multiple times with different value of this environment variable.</li>
</ul>
<h3 id="examples_1">Examples<a class="headerlink" href="#examples_1" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup for the db2w-shared Db2 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_db2

# Incremental backup for the db2w-shared Db2 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_db2

# Create a scheduled backup Job for the db2w-shared Db2 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_SCHEDULE=&quot;50 0 * * *&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_db2

# Restore for the db2w-shared Db2 instance
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_db2
</code></pre>
<h2 id="backuprestore-for-mas-core">Backup/Restore for MAS Core<a class="headerlink" href="#backuprestore-for-mas-core" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_core</code> will backup the following components that MAS Core depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_2">Environment Variables<a class="headerlink" href="#environment-variables_2" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. The MAS instance ID to perform a backup for.</li>
</ul>
<h3 id="examples_2">Examples<a class="headerlink" href="#examples_2" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all core data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_core

# Incremental backup all core data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_core

# Create a scheduled backup Job for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_SCHEDULE=&quot;50 0 * * *&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_core

# Restore all core data for the dev1 instance
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
ansible-playbook ibm.mas_devops.br_core
</code></pre>
<h2 id="backuprestore-for-manage">Backup/Restore for Manage<a class="headerlink" href="#backuprestore-for-manage" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_manage</code> will backup the following components that Manage depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core</td>
</tr>
<tr>
<td>db2</td>
<td><a href="../../roles/db2/">db2</a></td>
<td>Db2 instance used by Manage</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>manage</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>Manage namespace resources <br>Persistent volume data, such as attachments</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_3">Environment Variables<a class="headerlink" href="#environment-variables_3" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>DB2_INSTANCE_NAME</code> <strong>Required</strong>. This playbook will backup the the Db2 instance used by Manage, you need to set the correct Db2 instance name for this environment variable.</li>
</ul>
<h3 id="examples_3">Examples<a class="headerlink" href="#examples_3" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all manage data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_manage

# Incremental backup all manage data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_manage

# Restore all manage data for the dev1 instance and ws1 workspace
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_manage

# Create a scheduled backup of all manage data for the dev1 instance and ws1 workspace
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_manage
</code></pre>
<h2 id="backuprestore-for-iot">Backup/Restore for IoT<a class="headerlink" href="#backuprestore-for-iot" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_iot</code> will backup the following components that IoT depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core and IoT</td>
</tr>
<tr>
<td>db2</td>
<td><a href="../../roles/db2/">db2</a></td>
<td>Db2 instance used by IoT</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>iot</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>IoT namespace resources</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_4">Environment Variables<a class="headerlink" href="#environment-variables_4" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>DB2_INSTANCE_NAME</code> <strong>Required</strong>. This playbook will backup the the Db2 instance used by IoT, you need to set the correct Db2 instance name for this environment variable.</li>
</ul>
<h3 id="examples_4">Examples<a class="headerlink" href="#examples_4" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all iot data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_iot

# Incremental backup all iot data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_iot

# Restore all iot data for the dev1 instance
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_iot

# Create a scheduled backup of all iot data for the dev1 instance
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_iot
</code></pre>
<h2 id="backuprestore-for-monitor">Backup/Restore for Monitor<a class="headerlink" href="#backuprestore-for-monitor" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_monitor</code> will backup the following components that Monitor depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core, IoT and Monitor</td>
</tr>
<tr>
<td>db2</td>
<td><a href="../../roles/db2/">db2</a></td>
<td>Db2 instance used by IoT and Monitor</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>iot</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>IoT namespace resources</td>
</tr>
<tr>
<td>monitor</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>Monitor namespace resources</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_5">Environment Variables<a class="headerlink" href="#environment-variables_5" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>DB2_INSTANCE_NAME</code> <strong>Required</strong>. This playbook will backup the the Db2 instance used by IoT and Monitor, you need to set the correct Db2 instance name for this environment variable.</li>
</ul>
<h3 id="examples_5">Examples<a class="headerlink" href="#examples_5" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all monitor data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_monitor

# Incremental backup all monitor data for the dev1 instance
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_monitor

# Restore all monitor data for the dev1 instance
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_monitor

# Create a scheduled backup of all monitor data for the dev1 instance
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=db2w-shared
ansible-playbook ibm.mas_devops.br_monitor
</code></pre>
<h2 id="backuprestore-for-health">Backup/Restore for Health<a class="headerlink" href="#backuprestore-for-health" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_health</code> will backup the following components that Health depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core</td>
</tr>
<tr>
<td>db2</td>
<td><a href="../../roles/db2/">db2</a></td>
<td>Db2 instance used by Manage and Health</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>manage</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>Manage namespace resources <br>Persistent volume data, such as attachments</td>
</tr>
<tr>
<td>health</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>Health namespace resources <br>Watson Studio project assets</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_6">Environment Variables<a class="headerlink" href="#environment-variables_6" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>DB2_INSTANCE_NAME</code> <strong>Required</strong>. This playbook will backup the the Db2 instance used by Manage and Health, you need to set the correct Db2 instance name for this environment variable.</li>
</ul>
<h3 id="examples_6">Examples<a class="headerlink" href="#examples_6" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all health data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_health

# Incremental backup all health data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_health

# Restore all health data for the dev1 instance and ws1 workspace
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_health

# Create a scheduled backup of all health data for the dev1 instance and ws1 workspace
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_health
</code></pre>
<h2 id="backuprestore-for-optimizer">Backup/Restore for Optimizer<a class="headerlink" href="#backuprestore-for-optimizer" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_optimizer</code> will backup the following components that Optimizer depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core and Optimizer</td>
</tr>
<tr>
<td>db2</td>
<td><a href="../../roles/db2/">db2</a></td>
<td>Db2 instance used by Manage</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>manage</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>Manage namespace resources <br>Persistent volume data, such as attachments</td>
</tr>
<tr>
<td>optimizer</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>Optimizer namespace resources</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_7">Environment Variables<a class="headerlink" href="#environment-variables_7" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>DB2_INSTANCE_NAME</code> <strong>Required</strong>. This playbook will backup the the Db2 instance used by Manage, you need to set the correct Db2 instance name for this environment variable.</li>
</ul>
<h3 id="examples_7">Examples<a class="headerlink" href="#examples_7" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all optimizer data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_optimizer

# Incremental backup all optimizer data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_optimizer

# Restore all optimizer data for the dev1 instance and ws1 workspace
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_optimizer

# Create a scheduled backup of all optimizer data for the dev1 instance and ws1 workspace
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
export DB2_INSTANCE_NAME=mas-dev1-ws1-manage
ansible-playbook ibm.mas_devops.br_optimizer
</code></pre>
<h2 id="backuprestore-for-visual-inspection">Backup/Restore for Visual Inspection<a class="headerlink" href="#backuprestore-for-visual-inspection" title="Permanent link"></a></h2>
<p>This playbook <code>ibm.mas_devops.br_visualinspection</code> will backup the following components that Visual Inspection depends on in order:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Ansible Role</th>
<th>Data included</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodb</td>
<td><a href="../../roles/mongodb/">mongodb</a></td>
<td>MongoDB databases used by MAS Core and Visual Inspection</td>
</tr>
<tr>
<td>core</td>
<td><a href="../../roles/suite_backup_restore/">suite_backup_restore</a></td>
<td>MAS Core namespace resources</td>
</tr>
<tr>
<td>visualinspection</td>
<td><a href="../../roles/suite_app_backup_restore/">suite_app_backup_restore</a></td>
<td>Visual Inspection namespace resources <br>Persistent volume data, such as images and models</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables_8">Environment Variables<a class="headerlink" href="#environment-variables_8" title="Permanent link"></a></h3>
<ul>
<li><code>MAS_INSTANCE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS instance at a time. If you have multiple MAS instances in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
<li><code>MAS_WORKSPACE_ID</code> <strong>Required</strong>. This playbook only supports backing up components belong to a specific MAS workspace at a time. If you have multiple MAS workspaces in the cluster to be backed up, you need to run this playbook multiple times with different value of this environment variable.</li>
</ul>
<h3 id="examples_8">Examples<a class="headerlink" href="#examples_8" title="Permanent link"></a></h3>
<pre><code class="language-bash"># Full backup all visual inspection data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
ansible-playbook ibm.mas_devops.br_visualinspection

# Incremental backup all visual inspection data for the dev1 instance and ws1 workspace
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
ansible-playbook ibm.mas_devops.br_visualinspection

# Restore all visual inspection data for the dev1 instance and ws1 workspace
export MASBR_ACTION=restore
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MASBR_RESTORE_FROM_VERSION=20240630132439
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
ansible-playbook ibm.mas_devops.br_visualinspection

# Create a scheduled backup of all visual inspection data for the dev1 instance and ws1 workspace
# This will run at 01:00, Monday through Friday
export MASBR_ACTION=backup
export MASBR_BACKUP_TYPE=incr
export MASBR_BACKUP_SCHEDULE=&quot;0 1 * * 1-5&quot;
export MASBR_JOB_TIMEZONE=&quot;Asia/Shanghai&quot;
export MASBR_STORAGE_TYPE=local
export MASBR_STORAGE_LOCAL_FOLDER=/tmp/backup
export MAS_INSTANCE_ID=dev1
export MAS_WORKSPACE_ID=ws1
ansible-playbook ibm.mas_devops.br_visualinspection
</code></pre>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link"></a></h2>
<h3 id="directory-structure">Directory Structure<a class="headerlink" href="#directory-structure" title="Permanent link"></a></h3>
<p>No matter what kind of storage systems you choose, the folder structure created in the storage system is same.</p>
<p>Below is the sample folder structure for saving backup jobs:</p>
<pre><code>&lt;root_folder&gt;/backups/mongodb-main-full-20240621122530
├── backup.yml
├── database
│   ├── mongodb-main-full-20240621122530.tar.gz
│   └── query.json
└── log
    ├── mongodb-main-full-20240621122530-backup-log.tar.gz
    └── mongodb-main-full-20240621122530-ansible-log.tar.gz

&lt;root_folder&gt;/backups/core-main-full-20240621122530
├── backup.yml
├── log
│   ├── core-main-full-20240621122530-ansible-log.tar.gz
│   └── core-main-full-20240621122530-namespace-log.tar.gz
└── namespace
    └── core-main-full-20240621122530-namespace.tar.gz
</code></pre>
<ul>
<li><code>&lt;root_folder&gt;</code>: the root folder is specified by <code>MASBR_STORAGE_LOCAL_FOLDER</code> or <code>MASBR_STORAGE_CLOUD_BUCKET</code></li>
<li>The backup playbooks will create a seperated backup job folder under the <code>backups</code> folder for each component. The backup job folder is named by following this format: <code>{BACKUP COMPONENT}-{INSTANCE ID}-{BACKUP TYPE}-{BACKUP VERSION}</code>.</li>
<li>When using playbook to backup multiple components at once, all backup job folders will be assigned to the same backup version. In above example, the same backup version <code>20240621122530</code> for backing up <code>mongodb</code> and <code>core</code> components.</li>
<li><code>backup.yml</code>: keep the backup job information</li>
<li><code>database</code>: data type for database. This folder save the backup files of MongoDB database, Db2 database.</li>
<li><code>namespace</code>: data type for namespace resources. This folder save the exported namespace resources.</li>
<li><code>pv</code>: data type for persistent volume. This folder save the persistent volume data, e.g. the Manage attachments, VI images and models.</li>
<li><code>log</code>: this folder save all job running log files</li>
</ul>
<p>In addition to the backup jobs, we also save restore jobs in the specified storage location. For example:</p>
<pre><code>&lt;root_folder&gt;/restores/mongodb-main-incr-20240622040201-20240622075501
├── log
│   ├── mongodb-main-incr-20240622040201-20240622075501-ansible-log.tar.gz
│   └── mongodb-main-incr-20240622040201-20240622075501-restore-log.tar.gz
└── restore.yml

&lt;root_folder&gt;/restores/core-main-incr-20240622040201-20240622075501
├── log
│   ├── core-main-incr-20240622040201-20240622075501-ansible-log.tar.gz
│   └── core-main-incr-20240622040201-20240622075501-namespace-log.tar.gz
└── restore.yml
</code></pre>
<p>The restore playbooks will create a seperated restore job folder under the <code>restores</code> folder for each component. The restore job folder is named by following this format: <code>{BACKUP JOB NAME}-{RESTORE VERSION}</code>.</p>
<ul>
<li><code>restore.yml</code>: keep the restore job information</li>
<li><code>log</code>: this folder save all job running log files</li>
</ul>
<h3 id="data-model">Data Model<a class="headerlink" href="#data-model" title="Permanent link"></a></h3>
<h4 id="backupyml">backup.yml<a class="headerlink" href="#backupyml" title="Permanent link"></a></h4>
<pre><code class="language-yaml">kind: Backup
name: &quot;core-main-incr-20240622040201&quot;
version: &quot;20240622040201&quot;
type: &quot;incr&quot;
from: &quot;core-main-full-20240621122530&quot;
source:
  domain: &quot;source-cluster.mydomain.com&quot;
  suite: &quot;8.11.11&quot;
  instance: &quot;main&quot;
  workspace: &quot;&quot;
component:
  name: &quot;core&quot;
  instance: &quot;main&quot;
  namespace: &quot;mas-main-core&quot;
data:
  - seq: &quot;1&quot;
    type: &quot;namespace&quot;
    phase: &quot;Completed&quot;
status:
  phase: &quot;Completed&quot;
  startTimestamp: &quot;2024-06-22T04:05:22&quot;
  completionTimestamp: &quot;2024-06-22T04:06:04&quot;
  sentNotifications:
    - type: &quot;Slack&quot;
      channel: &quot;#ansible-slack-dev&quot;
      timestamp: &quot;2024-06-22T04:05:34&quot;
      phase: &quot;InProgress&quot;
    - type: &quot;Slack&quot;
      channel: &quot;#ansible-slack-dev&quot;
      timestamp: &quot;2024-06-22T04:06:10&quot;
      phase: &quot;Completed&quot;
</code></pre>
<h4 id="restoreyml">restore.yml<a class="headerlink" href="#restoreyml" title="Permanent link"></a></h4>
<pre><code class="language-yaml">kind: Restore
name: &quot;core-main-incr-20240622040201-20240622075501&quot;
version: &quot;20240622075501&quot;
from: &quot;core-main-incr-20240622040201&quot;
target:
  domain: &quot;target-cluster.mydomain.com&quot;
component:
  name: &quot;core&quot;
  instance: &quot;main&quot;
  namespace: &quot;mas-main-core&quot;
data:
  - seq: 1
    type: &quot;namespace&quot;
    phase: &quot;Completed&quot;
status:
  phase: &quot;Completed&quot;
  startTimestamp: &quot;2024-06-22T08:04:19&quot;
  completionTimestamp: &quot;2024-06-22T08:04:33&quot;
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../uninstall-core/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../roles/ocp_cluster_monitoring/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
