---
# tasks file for masms_smtp_sendgrid
# 1. SendGrid Process for new MASMS Customer
# 2. Configuring SendGrid in MAS Core
# 3. Configuring SendGrid in MAS Manage
# 4. SendGrid Domain Authentication

- name: Debug Information
  debug:
    msg:
      - "MAS Instance Id ... {{ mas_instance_id }}"
      - "MAS Config Dir .... {{ mas_config_dir }}"
      - "Customer Name ......{{ customer_name }}"

- name: Lookup for existent configuration in MAS
  community.kubernetes.k8s_info:
    api_version: v1
    kind: SmtpCfg
    namespace: mas-{{mas_instance_id}}-core
  register: _existent_smtp


- include_tasks: tasks/sendgrid_new_mas.yml
  when:
    -  _existent_smtp.resources | length == 0
