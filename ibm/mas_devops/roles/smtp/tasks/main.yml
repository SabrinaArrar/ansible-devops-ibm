---
# tasks file for masms_smtp_sendgrid
# 1. SendGrid Process for new MASMS Customer
# 2. Configuring SendGrid in MAS Core
# 3. Configuring SendGrid in MAS Manage
# 4. SendGrid Domain Authentication

- name: Debug Information
  debug:
    msg:
      - "SMTP Type ......... {{ smtp_type }}"
      - "MAS Instance Id ... {{ mas_instance_id }}"
      - "MAS Config Dir .... {{ mas_config_dir }}"
      - "SMTP User Name .... {{ masms_smtp_user_name }}"


- name: Lookup for existent configuration in MAS
  kubernetes.core.k8s_info:
    api_version: v1
    kind: SmtpCfg
    namespace: mas-{{ mas_instance_id }}-core
  register: _existent_smtp


- include_tasks: tasks/providers/{{ smtp_type }}.yml
  when:
    - _existent_smtp.resources | length == 0
