---
# 1. Failure conditions
# -----------------------------------------------------------------------------
- name: "sendgrid : Fail if required properties are not provided"
  assert:
    that:
      - smtp_type is defined and smtp_type != "" and smtp_type is in supported_smtp_types
      - mas_instance_id is defined and mas_instance_id != ""
      - mas_config_dir is defined and mas_config_dir != ""
    fail_msg: "Missing required properties"

- name: "Fail if mas_workload_scale_class is not set correctly"
  assert:
    that: mas_workload_scale_class is in ['BestEffort', 'Burstable', 'Guaranteed']
    fail_msg: "mas_workload_scale_class must be one of ['BestEffort', 'Burstable', 'Guaranteed']"

# 2. Debug information
# -----------------------------------------------------------------------------
- name: Debug Information
  debug:
    msg:
      - "SMTP Type .............................. {{ smtp_type }}"
      - "MAS Instance Id ........................ {{ mas_instance_id }}"
      - "MAS Config Dir ......................... {{ mas_config_dir }}"

# 2. Workload scale configuration
# -----------------------------------------------------------------------------
- name: "Set facts : mas_workload_scale_file"
  set_fact:
    mas_workload_scale_file: "{{ role_path }}/../../common_vars/podTemplates/{{ mas_workload_scale_class | lower }}.yml"
  when:
    - (mas_workload_scale_file is not defined) or (mas_workload_scale_file is defined and mas_workload_scale_file == '')
    - mas_workload_scale_class != 'Burstable'

- name: Load workload scale configuration file
  include_vars: "{{ mas_workload_scale_file }}"
  when:
    - mas_workload_scale_file is defined
    - mas_workload_scale_file != ''

# 3. Execute provider specific tasks
# -----------------------------------------------------------------------------
- include_tasks: tasks/providers/{{ smtp_type }}.yml
