---

# 1. Check for undefined properties that do not have a default
# -----------------------------------------------------------------------------
- name: "Fail if mas_instance_id is not provided"
  when: mas_instance_id is not defined or mas_instance_id|length == 0
  fail:
    msg: "mas_instance_id property is required"

- name: "Fail if mas_workspace_id is not provided"
  when: mas_workspace_id is not defined or mas_workspace_id|length == 0
  fail:
    msg: "mas_workspace_id property is required"

# 2. Provide debug information
# -----------------------------------------------------------------------------
- name: "Configure namespace"
  set_fact:
    mas_namespace: "mas-{{ mas_instance_id }}-core"

- name: "Debug information"
  debug:
    msg:
      - "Instance ID ............... {{ mas_instance_id }}"
      - "Workspace ID ............... {{ mas_workspace_id }}"
      - "MAS namespace ............. {{ mas_namespace }}"

# 3. Configure MAS workspace
# -----------------------------------------------------------------------------

- name: "Configure MAS workspace"
  vars:
    instance_id: "{{ mas_instance_id }}"
    workspace_id: "{{ mas_workspace_id }}"
    workspace_template: "{{ mas_app_workspace_configure }}"
  community.kubernetes.k8s:
    state: present
    namespace: "{{ mas_namespace }}"
    definition: "{{ workspace_template }}"
