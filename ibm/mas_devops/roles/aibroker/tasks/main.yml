---
- name: Load variables (main)
  include_vars: "vars/main.yml"

- name: "patch pipeline-runner-instance SA"
  # shell: oc patch sa -n {{ aibroker_namespace }} pipeline-runner-instance --type='merge' -p '{"imagePullSecrets":[{"name":"regcred"}]}'
  #shell: oc patch sa -n {{ aibroker_namespace }} pipeline-runner-instance --type='merge' -p '{"imagePullSecrets":[{"name":"ibm-entitlement"}]}'
  shell: oc patch sa -n {{ aibroker_namespace }} pipeline-runner-instance --type='merge' -p '{"imagePullSecrets":[{"name":"{{ pullSecretName }}"}]}'
  register: patch_output

# install AI Broker api
- include_tasks: tasks/aibroker/main.yml

# create AI Broker tenant
- include_tasks: tasks/tenant/main.yml

# create AI Broker api key
- include_tasks: tasks/apikey/main.yml

# create s3 sectet
- include_tasks: tasks/s3/main.yml

# create wx secret
- include_tasks: tasks/watsonx/main.yml
