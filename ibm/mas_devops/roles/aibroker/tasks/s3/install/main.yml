---
- name: "Check if S3 key secret exists in namespace: {{ aibroker_namespace }}"
  k8s_info:
    api_version: v1
    kind: Secret
    name: "{{ tenantNamespace }}----s3-secret"
    namespace: "{{ aibroker_namespace }}"
  register: s3_apikey_secret_info

- name: s3 details
  debug:
    msg:
    - "Tenant namespace: .......... {{ tenantNamespace }}"
    - "Aibroker namespace: .......... {{ aibroker_namespace }}"
    - "Storage provider: .......... {{ storage_provider }}"
    - "Storage host: .......... {{ storage_host }}"
    - "Storage port: .......... {{ storage_port }}"
    - "Storage region: .......... {{ storage_region }}"


- name: Create S3 API Key
  script: "{{ role_path }}/files/create_s3.sh {{ tenantNamespace }} {{ aibroker_namespace }} {{ storage_host }} {{ storage_accesskey }} {{ storage_secretkey }} {{ storage_region }} {{ storage_provider }} {{ storage_port }}"
  when:
    - s3_apikey_secret_info.resources | length == 0
  register: script_output
