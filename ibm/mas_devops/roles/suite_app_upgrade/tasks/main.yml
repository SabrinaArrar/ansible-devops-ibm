---

# 1. Load variables
# -----------------------------------------------------------------------------
- name: "Load application compatibility matrix"
  include_vars: "{{ role_path }}/../../common_vars/compatibility_matrix.yml"
- name: "Load application information"
  include_vars: "{{ role_path }}/../../common_vars/application_info.yml"


# 2. Check if the app is upgradeable from current version (n-1)
# -----------------------------------------------------------------------------
- name: "Check existing application installation"
  include_tasks: tasks/check_app_compatibility.yml


# # 3. Check if the app is compatible with the version of MAS core platform
# # -----------------------------------------------------------------------------
- name: "Check MAS core compatability"
  include_tasks: tasks/check_core_compatibility.yml


# # 4. Upgrade
# -----------------------------------------------------------------------------
- name: "Execute Channel Upgrade"
  when:
    - app_sub_info.resources[0].spec.channel != mas_app_channel
    - not mas_upgrade_dryrun
  include_tasks: tasks/upgrade.yml
