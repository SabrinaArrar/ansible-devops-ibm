---
# 1. Provide debug information to the user
# -----------------------------------------------------------------------------
- name: "Debug information"
  debug:
    msg:
      - "AWS User Name .......................... {{ aws_username }}"
      - "AWS Policy ARN ......................... {{ aws_policy_arn }}"

- name: "Create an IAM user {{ aws_username }}"
  shell: |
    aws iam create-user --user-name {{ aws_username }}
  register: iam_user_create_output
  failed_when: iam_user_create_output.rc > 0 and ('EntityAlreadyExists' not in iam_user_create_output.stderr)

- name: "Attach IAM policy to IAM user {{ aws_username }}"
  shell: |
    aws iam attach-user-policy --user-name {{ aws_username }} --policy-arn {{ aws_policy_arn }}
  register: iam_attach_policy_output
  failed_when: iam_attach_policy_output.rc > 0
