---
- name: "Fail if aws_user_name is not provided"
  assert:
    that: aws_user_name is defined and aws_user_name != ""
    fail_msg: "aws_user_name property is required"

- name: "Fail if aws_user_action_list is not provided"
  assert:
    that: aws_user_action_list is defined and aws_user_action_list | length > 0
    fail_msg: "aws_user_action_list property is required"

- name: "Fail if aws_resources_list is not provided"
  assert:
    that: aws_resources_list is defined and aws_resources_list | length > 0
    fail_msg: "aws_resources_list property is required"

# 1. Provide debug information to the user
# -----------------------------------------------------------------------------
- name: "Debug information"
  debug:
    msg:
      - "AWS Region.............................. {{ aws_region }}"
      - "AWS User Name........................... {{ aws_user_name }}"
      - "AWS User Action List ................... {{ aws_user_action_list }}"
      - "AWS Resources List ..................... {{ aws_resources_list }}"

- name: "Create a new aws username {{ aws_user_name }}"
  community.aws.iam_user:
    name: "{{ aws_user_name }}"
    state: present
  register: iam_user_creation_output

- debug:
    msg: "{{ iam_user_creation_output }}"

- name: "Create a new access key for aws username {{ aws_user_name }}"
  community.aws.iam_access_key:
    user_name: "{{ aws_user_name }}"
    state: present
  register: iam_access_key_creation_output

- debug:
    msg: "{{ iam_access_key_creation_output }}"
