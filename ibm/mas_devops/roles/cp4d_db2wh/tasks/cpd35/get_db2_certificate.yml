---
# -----------------------------------------------------------------------------
# Set DB2 SSL Port (db2wh_certificate) into Facts
# -----------------------------------------------------------------------------
- name: Lookup db2wh TLS certificates
  community.kubernetes.k8s_info:
    api_version: v1
    kind: Secret
    name: "internal-tls"
    namespace: "{{db2wh_namespace}}"
  register: _db2u_instance_certificates

- name: Set Db2wh certificates as Facts
  set_fact:
    # We need to use certificate.pem rather than tls.crt when we create the JdbcCfg for MAS
    db2wh_certificate: "{{ _db2u_instance_certificates.resources[0].data['certificate.pem'] | b64decode }}"
  when:
    - _db2u_instance_certificates is defined
    - (_db2u_instance_certificates.resources | length > 0)
