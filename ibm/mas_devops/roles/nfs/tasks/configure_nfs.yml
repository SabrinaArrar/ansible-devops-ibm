---
# 1. Create namespace we will deploy to
# -----------------------------------------------------------------------------
- name: "Create namespace"
  kubernetes.core.k8s:
    api_version: v1
    kind: Namespace
    name: "{ { nfs_namespace } }"


# 2. Configure rbac
# -----------------------------------------------------------------------------
- name: "Configure rbac"
  kubernetes.core.k8s:
    apply: yes
    definition: "{{ lookup('template', 'templates/rbac.yml') }}"


# 3. Configure service account
# -----------------------------------------------------------------------------
- name: "Configure service account"
  shell: |
    oc adm policy add-scc-to-user hostmount-anyuid system:serviceaccount:{ { nfs_namespace } }:nfs-client-provisioner 


# 4. Configure class
# -----------------------------------------------------------------------------
- name: "Configure class"
  kubernetes.core.k8s:
    apply: yes
    definition: "{{ lookup('template', 'templates/class.yml') }}"


# 5. Configure deployment
# -----------------------------------------------------------------------------
- name: "Configure deployment"
  kubernetes.core.k8s:
    apply: yes
    definition: "{{ lookup('template', 'templates/deployment.yml') }}"