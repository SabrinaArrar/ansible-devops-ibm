---
# 1. Obtain Private IP, if not provided, but Fyre credentials are
# -----------------------------------------------------------------------------
- name: "Get Cluster Details"
  uri:
    url: "{{ fyre_api_get_cluster_info }}"
    user: "{{ fyre_username }}"
    password: "{{ fyre_password }}"
    method: GET
    force_basic_auth: yes
    validate_certs: false
  register: _cluster_details

- set_fact:
    private_ip: "{{ _cluster_details.json.clusters[0].vms | json_query('[?contains(hostname, `api`)].ips[-1].address') }}"

- name: "Obtain Private IP of the Fyre Infrastructure Node"
  shell:
    echo {{ private_ip }} | grep -oE '\b([0-9]{1,3}.){3}[0-9]{1,3}\b'
  register: fyre_inf_node_private_ip

- name: debug
  debug:
    var: fyre_inf_node_private_ip
