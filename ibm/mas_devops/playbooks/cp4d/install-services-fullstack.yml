---
- hosts: localhost
  any_errors_fatal: true
  vars:
    # Cluster details
    # -----------------------------------------------------------------------------------------------------------------
    # cluster_type allows us to check whether it's a ROKS cluster or not. CPD v4 install has specific roks steps to
    # reload worker nodes after we setup image pull secret that won't work for non-roks clusters.
    cluster_name: "{{ lookup('env', 'CLUSTER_NAME') }}"
    cluster_type: "{{ lookup('env', 'CLUSTER_TYPE') }}"

    # CP4D basic installation
    # ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    cpd_version: "{{ lookup('env', 'CPD_VERSION') }}"
    # As an alternative to using the cpd_version, the mas_channel can be used to dynamically determine the correct
    # version of CPD to install (in some cases, but not all)
    mas_channel: "{{ lookup('env', 'MAS_CHANNEL') }}"

    cpd_registry: cp.icr.io
    cpd_registry_user: cp
    cpd_registry_password: "{{ lookup('env', 'CPD_ENTITLEMENT_KEY') }}"
    cpd_meta_namespace: "{{ lookup('env', 'CPD_NAMESPACE') | default('cpd-meta-ops', true) }}"

    # CP4D service configuration
    # -----------------------------------------------------------------------------------------------------------------
    cpd_storage_class: "{{ lookup('env', 'CPD_STORAGE_CLASS') }}"
    cpd_block_storage_class: "{{ lookup('env', 'CPD_BLOCK_STORAGE_CLASS') }}"
    cpd_services:
      # Db2 warehouse and Db2 management console
      - db2wh       # Required by IoT, Manage, Monitor
      # Watson Studio with Watson Machine Learning, Apache Spark, & Watson AI OpenScale capabilities enabled
      - wsl         # Required by Predict & HP Utilities
      - wml         # Required by Predict
      - spark       # Required by Predict
      - aiopenscale # Optional, used by Predict

  roles:
    - ibm.mas_devops.cp4d_install
    - ibm.mas_devops.cp4d_install_services
