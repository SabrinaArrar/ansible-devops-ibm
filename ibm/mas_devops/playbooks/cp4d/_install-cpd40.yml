---
- hosts: localhost
  any_errors_fatal: true
  vars:
    cluster_name: "{{ lookup('env', 'CLUSTER_NAME') }}"
    cluster_type: "{{ lookup('env', 'CLUSTER_TYPE') }}"
    cpd_registry: cp.icr.io
    cpd_registry_user: cp
    cpd_registry_password: "{{ lookup('env', 'CPD_ENTITLEMENT_KEY') }}"
    cpd_meta_namespace:  "{{ lookup('env', 'CPD_NAMESPACE') | default('ibm-common-services', true) }}"
    cpd_version: "cpd40"
    # CP4D service configuration
    cpd_storage_class: "{{ lookup('env', 'CPD_STORAGE_CLASS') }}"
    cpd_block_storage_class: "{{ lookup('env', 'CPD_BLOCK_STORAGE_CLASS') }}"
    cpd_services:
      - db2wh       # Required by IoT, Manage, Monitor apps
      - dmc         # Optional, provides Db2 admin dashboard for customer
      # Watson Studio with Watson Machine Learning, Apache Spark, & Watson AI OpenScale capabilities enabled
      - wsl         # Required by Predict & HP Utilities
      - wml         # Required by Predict
      - spark       # Required by Predict
      - aiopenscale # Optional, used by Predict
      - dods        # Optional, used by MSO
      - wd          # Required by Assist app

    # Create the MAS JdbcCfg & Secret resource definitions
    mas_instance_id: "{{ lookup('env', 'MAS_INSTANCE_ID') }}"
    mas_config_dir: "{{ lookup('env', 'MAS_CONFIG_DIR') }}"
    db2wh_cfg_file: /tmp/jdbccfg-cp4ddb2wh-system.yaml
  roles:
    - ibm.mas_devops.cp4d40_install
    - ibm.mas_devops.cp4d40_install_services
    - ibm.mas_devops.cp4d40_db2wh
