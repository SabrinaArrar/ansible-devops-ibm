---

- hosts: localhost
  any_errors_fatal: true
  vars:
    upgrade_db2: "{{ lookup('env', 'UPGRADE_DB2') | default ('True', True) | bool  }}"
    upgrade_apps: "{{ lookup('env', 'UPGRADE_APPS') | default ('True', True) | bool }}"

    mas_channel: "{{ lookup('env', 'MAS_CHANNEL') }}"
    mas_app_channel_assist: "{{ lookup('env', 'MAS_APP_CHANNEL_ASSIST') }}"
    mas_app_channel_hputilities: "{{ lookup('env', 'MAS_APP_CHANNEL_HPUTILITIES') }}"
    mas_app_channel_iot: "{{ lookup('env', 'MAS_APP_CHANNEL_IOT') }}"
    mas_app_channel_manage: "{{ lookup('env', 'MAS_APP_CHANNEL_MANAGE') }}"
    mas_app_channel_monitor: "{{ lookup('env', 'MAS_APP_CHANNEL_MONITOR') }}"
    mas_app_channel_optimizer: "{{ lookup('env', 'MAS_APP_CHANNEL_OPTIMIZER') }}"
    mas_app_channel_predict: "{{ lookup('env', 'MAS_APP_CHANNEL_PREDICT') }}"
    mas_app_channel_safety: "{{ lookup('env', 'MAS_APP_CHANNEL_SAFETY') }}"
    mas_app_channel_visualinspection: "{{ lookup('env', 'MAS_APP_CHANNEL_VISUALINSPECTION') }}"

  pre_tasks:
    # For the full set of supported environment variables refer to the playbook documentation
    - name: Check for required environment variables
      assert:
        that:
          - lookup('env', 'MAS_INSTANCE_ID') != ""
        fail_msg: "You must provide the target MAS instance ID"

  roles:
    # 1. Core
    # -------------------------------------------------------------------------
    - name: ibm.mas_devops.suite_upgrade
      when: upgrade_core
    - name: ibm.mas_devops.suite_verify
      when: upgrade_core